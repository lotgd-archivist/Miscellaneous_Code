
<?php//--------------------------------------------------------//|Grundlage und Proghilfe aus den php´s                 |//|Geschenkeladen; Wurfbude by Opal                      |//|gebaut als Eweiterung für`n Weihnachtsmarkt von Opal  |//--------------------------------------------------------//////   #############################//   #                           #//   # written by Anvil Dinarius #//   #                           #//   # www.land-elysion.de/logd/ #//   #                           #//   #############################//////... ~Wer lesen kann ist klar im Vorteil~ ... Darum nehmt euch bitte die Zeit, sorgfältig Zeile für Zeile zu lesen, was für euch in Frage kommt. ////// SQL Eintrag für die db `losbude` und `kuschel` nach Wunsch, oder ////                                ----                            //// SQL: ALTER TABLE `accounts` ADD `losbude` TINYINT(1) NOT NULL DEFAULT '0'; ////                                ----                                     //// Eintrag newday.php ... $session['user']['losbude']=0; ... einfügen. Vorzugsweise, wo schon das meiste genullt wird. Iss übersichtlicher. //// Zur Weihnachtsmarkt.php ... beliebiger Platz dort ... addnav("kleine Losebude","losbude.php"); ////...oder nav ändern / anpassen auf eure Bedüfnisse...////...bitte noch eins auf euren Server vorher anpassen. Und zwar den Output vom case 5 ... Azrael, den Engel des Todes ... ersetzen durch ... Ramius oder was auch immer ihr habt. ////...losbude.php aufen ftp laden sollte klar sein...//...@ Admin´s / Gründer / Einbauer ... Bitte nicht vergessen, wenn alles fertig ist und ihr es gleich testen wollt. Erst inner Grotte auf Datenbank reparieren klicken. //////...~Hoffe mal alle möglichen Fehlerquellen nun ausgeschloßen zu haben~ ... ~Feedback erwünschst~ ... //require_once "common.php";require_once "func/systemmail.php";page_header("Losbude");output("`n`c`b`&Die k`Bleine Loseb`&ude`b`c`n`n");output("`c`&Beim Schlendern über den Weihnachtsmarkt, `Beingehüllt von dem süß`&lichen Geruch, der überall `Bin der Luft liegt,`n `&läufst du an einer Los`Bbude vorbei, welche auch gleich `&deine Aufmerksamkeit erregt.`nVon d`Beiner Neugier überwältig, `&traust du dich etwas näher a`Bn die Bude heran. In `&der Mitte eine riesengroße Kist`Be voller Lose. Ein wenig zweifeln`&d, ob es sich lohnen würde, `Bdrängelst du dich näher heran.`&Jeder scheint hier `Bwohl sein Glück zu versuch`&en. Und warum nicht auch `Bdu, denkst du dir dann. Um dich he`&rum sind ja schließlich auc`Bh die verschiedensten Rassen `&friedlich vereint, und ha`Bben nur die Lose und die Gewinne im Kopf.`&Sicher vermagst du au`Bch manch verärgerten Ausruf zu hören, `&aber es kann nun mal nicht jeder gewin`Bnen. Vielleicht kannst du `&ja etwas hier gewinnen, denk`Bst du dir. Wer weiß dies schon.`c`n`n`n`q`b `c 1 Los kostet dich 10 Goldstücke und du darfst insgesamt 3 Lose ziehen.`b `n`n`n");$uebrig=3-$session['user']['losbude'];if ($_GET['op']==""){        addnav("`bkleine Losebude`b");        addnav("$uebrig x Lose ziehen","losbude.php?op=lose");        addnav("`bZurück`b");        addnav("Zurück","weihnachtsmarkt.php");}if ($_GET['op']=="lose"){        if($session['user']['gold']>=10){                $session['user']['losbude']+=1;                if($session['user']['losbude']>=4){                        output("`q`nDu kannst heute keine Lose mehr ziehen");                        $session['user']['losbude']=3;                        addnav("Zurück","weihnachtsmarkt.php");                }else if($session['user']['losbude']<=3){                        output("`9Du zahlst den Einsatz, wühlst dich durch eine rießengroße Kiste voller Lose, bis du eines ergreifst, bei dem du ein gutes Gefühl hast.`n`n`n");                        $session['user']['gold']-=10;                        switch(mt_rand(1,10)){                                case 1:                                            output("`^Schade, leider eine Niete, und dies reicht nicht mal für einen Trostpreis`n`n");        addnav("Weiter","losbude.php");                                               break;                                               case 2:                                output("`^Leider ist da nur ein Laubbaum drauf. Aber du erhältst die Hälfte deines Einsatzes zurück. Es ist ja schließlich fast Weihnachten, und da geben Laubbäume nicht viel her...`n`n");                                $session['user']['gold']+=5;        addnav("Weiter","losbude.php");                                         break;                                        case 3:                                output("`^Na ja, wenigsten eine Nadel ist auf deinem Los. Und du erhältst das Doppelte deines Einsatzes zurück`n`n");                                $session['user']['gold']+=20;        addnav("Weiter","losbude.php");                                         break;                                        case 4:                                output("`^Ups, da ist die böse Hexe drauf. Und du ärgerst dich so darüber, dass es anderen Besuchern auch auffällt. Du verlierst an Charme.`n`n");                                $session['user']['charm']--;        addnav("Weiter","losbude.php");                                         break;                                        case 5:                                    output("`^Aus Versehen lässt du das Los fallen. Als du es wieder aufhebst, und nochmal drauf schaust, erkennst du Azrael, den Engel des Todes. Und du verlierst ein paar Lebenspunkte.`n`n");                                    $session['user']['hitpoints']*=0.9;        addnav("Weiter","losbude.php");                                            break;                                        case 6:                                output("`^Super, auf deinem Los ist der grüne Drachen zu sehen. Dies könnte der Hauptgewinn sein ... Doch du gewinnst 5 Edelsteine.`n`n");                                $session['user']['gems']+=5;        addnav("Weiter","losbude.php");                                         break;                                         case 7:                                output("`^Geht doch. Du erkennst einen Nadelbaum auf deinem Los. Und bekommst dafür 160 Goldstücke.`n`n");                                $session['user']['gold']+=160;                                addnav("Weiter","losbude.php");                                         break;                                         case 8:                                output("`^Hui... Auf deinem Los ist ein schön verzierter kleiner Weihnachtsbaum zu sehen. Und du erhältst 160 Goldstücke und einen Edelstein dafür.`n`n");                                $session['user']['gold']+=160;                                $session['user']['gems']+=1;                                addnav("Weiter","losbude.php");                                                break;                                         case 9:                                output("`^Ein Windstoß pustet Dir dein Los aus der Hand, und panisch schreiend rennst du deinem Los über den halben Weihnachtsmarkt hinterher, und kannst es mit einem Hechtsprung wieder einfangen. Aber war es nur ein Niete, und du ärgerst dich. Jedoch scheint den anderen Besuchern deine kleine Showeinlage gefallen zu haben, und sie kratzen etwas Gold für dich zusammen.`n`n");                                addnews("`\$".$session['user']['name']." `\$hat eine kleine Showeinlage auf dem Weihnachtsmarkt gegeben. Einige sammelten sogar etwas dafür.");                                $session['user']['gold']+=17;                                addnav("Weiter","losbude.php");                                                break;                                         case 10:                                 output("`^Auf deinem Los ist ein kleiner niedlicher `\$Weihnachtsplüschdrache `^abgebildet. Du erhältst dafür 200 Gold und 4 Edelsteine, und das süße Kuschelding.`n Dann fragt dich eine kleine grüne Elfe...`n`n");                                 $session['user']['gold']+=200;                                 $session['user']['gems']+=4;                                 addnav("`\$Weihnachtsdrache","losbude.php?op=klick");                                         break;                        }                }        } else {                output("`qDu hast keine 10 Gold übrig. Wird wohl nix aus dem Lose ziehen im Moment....");                addnav("Zurück","weihnachtsmarkt.php");        }}//if ($session['user']['kuschel']>=1) addnav("`\$Weihnachtsdrache","losbude.php?op=klick");if ($_GET['op']=="send"){        $gift=$_GET['op2'];        if (isset($_POST['search']) || $_GET['search']>""){                if ($_GET['search']>"") $_POST['search']=$_GET['search'];                $search="%";                for ($x=0;$x<strlen($_POST['search']);$x++){                        $search .= substr($_POST['search'],$x,1)."%";                }                $search="name LIKE '".$search."' AND ";                if ($_POST['search']=="weiblich") $search="sex=1 AND ";                if ($_POST['search']=="männlich") $search="sex=0 AND ";        }else{                $search="";        }        $ppp=25; // Player Per Page to display        if (!$_GET[limit]){                $page=0;        }else{                $page=(int)$_GET[limit];                addnav("Vorherige Seite","losbude.php?op=send&op2=$gift&limit=".($page-1)."&search=$_POST[search]");        }        $limit="".($page*$ppp).",".($ppp+1);        $sql = "SELECT login,name,level,sex,acctid FROM accounts WHERE $search locked=0 AND acctid<>".$session[user][acctid]." AND lastip<>'".$session[user][lastip]."' ORDER BY login,level LIMIT $limit";        $result = db_query($sql);        if (db_num_rows($result)>$ppp) addnav("Nächste Seite","losbude.php?op=send&op2=$gift&limit=".($page+1)."&search=$_POST[search]");        output("`\$`nÜberglücklich strahlt dich die kleine Elfe an.`n \"Für wen ist denn das Geschenk bestimmt ?\"`n`n");        output("<form action='losbude.php?op=send&op2=$gift' method='POST'>Nach Name suchen: <input name='search' value='$_POST[search]'><input type='submit' class='button' value='Suchen'></form>",true);        addnav("","losbude.php?op=send&op2=$gift");        output("<table cellpadding='3' cellspacing='0' border='0'><tr class='trhead'><td>Name</td><td>Level</td><td>Geschlecht</td></tr>",true);        for ($i=0;$i<db_num_rows($result);$i++){                $row = db_fetch_assoc($result);                output("<tr class='".($i%2?"trlight":"trdark")."'><td><a href='losbude.php?op=send2&op2=$gift&name=".HTMLEntities($row['acctid'])."'>",true);                output($row['name']);                output("</a></td><td>",true);                output($row['level']);                output("</td><td align='center'><img src='images/".($row['sex']?"female":"male").".gif'></td></tr>",true);                addnav("","losbude.php?op=send2&op2=$gift&name=".HTMLEntities($row['acctid']));        }        output("</table>",true);        addnav("Zurück","losbude.php?op=klick");}if ($_GET['op']=="send2"){        $name=$_GET['name'];        $effekt="";        if ($_GET[op2]=="gift2"){                       $gift="`4We`ùih`Àna`Uch`&ts`Gpl`güs`och`2dr`*ac`phe`0";                   $effekt="Ein Weihnachtsplüschdrache zum schmusen";                    db_query("INSERT INTO items (name,owner,class,gold,description) VALUES ('`4We`ùih`Àna`Uch`&ts`Gpl`güs`och`2dr`*ac`phe`0',$name,'Geschenk',5,'Diesen Weihnachtsplüschdrachen hat dir ".$session[user][name]." geschenkt.')");          }        $mailmessage=$session['user']['name'];        $mailmessage.="`7 hat dir ein Geschenk geschickt.  Du öffnest es. Es ist ein `6";        $mailmessage.=$gift;        //you can change the following the match what you name your gift shop        $mailmessage.="`7 von der kleinen Losbude.`n".$effekt;        systemmail($name,"`2Geschenk erhalten!`2",$mailmessage);        output("`\$Mit leuchtenden Augen nimmt die kleine Elfe deinen `4We`ùih`Àna`Uch`&ts`Gpl`güs`och`2dr`*ac`phen`\$ entgegen. \"Ich verpacke ihn noch schnell für dich, schön als Geschenk!\"`n Und schon saust sie los.`n`n");        addnav("Weiter","losbude.php");}if ($_GET['op']=="klick"){        output("`\$Möchtest du den niedlichen Weihnachtsplüschdrachen behalten oder verschenken ?`n");        addnav("Verschenken","losbude.php?op=send&op2=gift2");        addnav("Behalten","losbude.php?op=selbst&op3=gift2");        addnav("Wegwerfen","weihnachtsmarkt.php");}if ($_GET['op']=="selbst"){        $session ['user']['acctid'];        $name=$session['user']['acctid'];        $effekt="";        if ($_GET[op3]=="gift2"){                   $gift="`4We`ùih`Àna`Uch`&ts`Gpl`güs`och`2dr`*ac`phe`0";                       $effekt="Ein Weihnachtsplüschdrache zum schmusen";                      db_query("INSERT INTO items (name,owner,class,gold,description) VALUES ('`4We`ùih`Àna`Uch`&ts`Gpl`güs`och`2dr`*ac`phe',$name,'Geschenk',5,'Diesen Weihnachtsplüschdrachen hat dir ".$session[user][name]." geschenkt.')");              }        output("`\$Mit leuchtenden Augen nimmt die kleine Elfe deinen Weihnachtsplüschdrachen entgegen. \"Ich verpacke ihn noch schnell für schön für dich!\"`n Und schon saust sie los.`n`n");        addnav("Weiter","losbude.php");}page_footer();?>

