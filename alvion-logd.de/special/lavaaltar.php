
<?php/*/ pietre.php - Magic Stones V0.2.1 geändert in Magic Ring von Tiger313/ Originally by Excalibur (www.ogsi.it)/ English cleanup by Talisman (dragonprime.cawsquad.net)/ Original concept from Aris (www.ogsi.it)/ May 2004/ 19. April 2005 Edit by Tiger313 Version: 1.1// translation and adjustments/ - pietra -> stones/ - changed storyline to the lava altar/ - new stones with VARIOUS MAGIC throughout the whole game/ by gargamel @ www.rabenthal.de*//*to do:  - table stones by user löschen berücksichtigen!*/$infos=array("owner"=>"Magic Ring am Lavaaltar","creator" => "Excalibur","editor" => "Tiger313","homepage" => "http://www.ogsi.it","homepage-editor" => "http://www.mlcrew.de","version" => "1.1","bugfix" => "Linus","homepage-bugfixer" => "http://www.alvion-logd.de/logd","version2" => "1.2");if (!isset($session)) exit();require_once "func/systemmail.php";$numstones = "25";if ($_GET[op]==""){    output("<font size='+1'>`c`b`!Der Lava-Altar`b`c`n</font>",true);    if ($session['user']['stones']==0){        output("`n`@Auf Deinem Weg auf der Suche nach Abenteuer findest Du hinter        einer Baumgruppe den legendären Lava-Altar.`n        Der auffällige Findling aus schwarzem Basalt zieht Dich in seinen Bann.        Du spürst die Hitze, die in der Nähe aus einer Erdspalte dringt. Und Du        erinnerst Dich an die Legende, die Du einst irgendwo gehört hast...`n`n        \"Wenn der Lava-Altar von "        .($session[user][sex]?"einer Würdigen ":"einem Würdigen ").        "berührt wird, öffnet sich die Erde und spuckt einen magischen Ring aus,        der seine Kräfte mit Dir teilt. Jene hat vielen geholfen, aber einigen        unglücklichen Besuchern auch eine schwere Bürde aufgeladen. Was auch immer        der Altar für Dich bereit hält, Du kannst die Kraft nicht ablegen - sie        muss Dir genommen werden. Wenn Deine Würde in den Augen der Götter schwindet        und ein Anderer den Altar berührt.`n        Die Kräfte wirken sofort, oder vom nächsten Tag an.\"`n        So hast Du es einst vernommen...`n`n        Du stehst etwas ratlos vor dem schwarzen Findling. Sollst Du es wagen?        Bist Du würdig?`0");        //abschluss intro        addnav("Altar berühren","forest.php?op=touch");        addnav("einfach weitergehen","forest.php?op=cont");        $session[user][specialinc] = "lavaaltar.php";    }    else {        $tmp=$session['user']['stones'];        $sql3="SELECT stonename FROM stones WHERE stone = $tmp";        $result3 = db_query($sql3) or die(db_error(LINK));        $row3 = db_fetch_assoc($result3);        $welcher = $row3['stonename'];        output("`n`@Auf Deinem Weg triffst Du wieder auf die Baumgruppe hinter der        sich der Lava-Altar befindet. `n        Weil Du den $welcher `@besitzt, regenerierst Du        vollständig. Deine Heilung dauert jedoch eine Weile und Du verlierst einen        Waldkampf.`0");        $session[user][turns]-=1;        if ($session[user][hitpoints]<$session[user][maxhitpoints])           $session[user][hitpoints]=$session[user][maxhitpoints];        $session[user][specialinc]="";    }}else if ($_GET[op]=="cont"){   // einfach weitergehen    output("`n`5Du verlässt den schwarzen Findling. Die Sache ist Dir irgendwie    nicht geheuer...`0");    $session[user][specialinc]="";}else if ($_GET[op]=="touch"){    $chance = e_rand(1,100);    if ( $chance < 55 ) {        output("`nEtwas zaghaft legst Du Deine Hand an den schwarzen Findling.        Sorgsam beobachtest Du die Umgebung. Nichts passiert...`n        Auch der Findling liegt da wie zuvor.`n`n        Du musst einsehen, dass Du nicht würdig bist und gehst zurück in den        Wald.`0");    }    else {        output("`nDu legst Deine Hand an den schwarzen Findling und wartest...`n        Schon bald fängt Deine Hand an zu kribbeln und Du spürst die Hitze weiter        ansteigen. Sollte sich etwa die Erde öffnen?`n`n`0");        $stones = e_rand(1,$numstones);        $sql="SELECT stone,owner,class,description,stonename,ringday FROM stones WHERE stone = $stones";        $result = db_query($sql) or die(db_error(LINK));        if ( db_num_rows($result) == 0 ) {            output("`nEtwas zaghaft legst Du Deine Hand an den schwarzen Findling.            Sorgsam beobachtest Du die Umgebung. Nichts passiert...`n            Auch der Findling liegt da wie zuvor.`n`n            Du musst einsehen, dass Du nicht würdig bist und gehst zurück in den            Wald.`0");        }        else {            $row = db_fetch_assoc($result);            $stein = $row['stone'];            $bisher = $row['owner'];            $welcher = $row['stonename'];        $tage = $row['ringday'];            if ( $bisher == 0 ) {  // Ring zuteilen                output("Mit tiefem Donner schiesst Dampf aus der nahegelegenen Erdspalte.                Durch den Druck wird ein kleiner Ring mit herausgeschleudert und landet                direkt vor Deinen Füssen. `bDu hast einen magischen Ring erhalten!`b `n`n`0");                switch ( $row['class'] ) {                    case 0: //positiv                    output("Zu Deiner grossen Freude erkennst Du, es ist: `@$welcher `0`n`n                    ".$row['description']."`n`0");                    break;                    case 1: //negativ                    output("Zu Deiner Bestürzung erkennst Du, es ist: `@$welcher `0 `n`n                    ".$row['description']."`n`0");                    break;                    case 2: //neutral                    output("Du erkennst, es ist: `@$welcher `0 `n`n                    ".$row['description']."`n`0");                    break;                }                $session['user']['stones']=$stein;                $id=$session[user][acctid];                $sql="UPDATE stones set owner = '".$id."', ringday = '1'                      WHERE stone = '".$stein."'";                db_query($sql);                addnews($session[user][name]." `0hat `@$welcher `0erhalten!");            }            else {  // Ring wegnehmen und zuteilen                $sql="SELECT name FROM accounts WHERE acctid = '".$bisher."'";                $result = db_query($sql) or die(db_error(LINK));                if ( db_num_rows($result) == 0 ) {                    $bishername = "Unbekannt";                }                else {                    $row2 = db_fetch_assoc($result);                    $bishername = $row2['name'];                }                output("Mit tiefem Donner schiesst Dampf aus der nahegelegenen Erdspalte.                Durch den Druck wird ein kleiner Ring mit herausgeschleudert und landet                direkt vor Deinen Füssen. `bDu hast einen magischen Ring erhalten!`b `n`n                Dazu hörst Du eine Stimme sagen: $bishername ist in Ungnade gefallen,                deshalb bekommst Du den Ring! Du bist würdiger!`n`n`0");                switch ( $row['class'] ) {                    case 0: //positiv                    output("Zu Deiner grossen Freude erkennst Du, es ist: `@$welcher `0 `n`n                    ".$row['description']."`n`0");                    break;                    case 1: //negativ                    output("Zu Deiner Bestürzung erkennst Du, es ist: `@$welcher `0 `n`n                    ".$row['description']."`n`0");                    break;                    case 2: //neutral                    output("Du erkennst, es ist: `@$welcher `0 `n`n                    ".$row['description']."`n`0");                    break;                }                // Ring altem besitzer nehmen                $sql2="UPDATE accounts set stones = 0 WHERE acctid = '".$bisher."'";                db_query($sql2);                /* Transferbug Fix */                updateuser($bisher,array('stones'=>"0"));                // und neu zuteilen                $session['user']['stones']=$stein;                $id=$session[user][acctid];                $sql="UPDATE stones set owner = '".$id."', ringday = '1'                      WHERE stone = '".$stein."'";                db_query($sql);                addnews($session[user][name]." `0hat `@$welcher `0erhalten!");                $mailmessage = "`@{$session['user']['name']} `@hat den Lava-Altar gefunden.                Die Götter haben entschieden, Deinen Ring an `@{$session['user']['name']}                zu geben, weil Du in Ungnade gefallen bist!";                systemmail($bisher,"`2Dein Ring wurde weitergegeben!",$mailmessage);            }            // # hier evtl. switch auf class ?        }    }    $session[user][specialinc]="";}//copyrightoutput("`n`n`n`n`n `2Orginal Idee by <a href='".$infos['homepage']."' target='_blank'>".$infos['creator']."</a> `2Modifiziert zu `^".$infos['owner']."  `2 by <a href='".$infos['homepage-editor']."' target='_blank'>".$infos['editor']."</a> Version ".$infos['version']."    `n`2Transferbugfix by <a href='".$infos['homepage-bugfixer']."' target='_blank'>".$infos['bugfix']."</a> Version ".$infos['version2']."`n`n",true);

