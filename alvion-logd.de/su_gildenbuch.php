
<?php/** Version:    0.01, 02.08.2009* Author:    Linus* Email:    webmaster@alvion-logd.de* Zweck:    Admintool für das Löschen von unnützen Einträgen im Gildenbuch**/require_once("common.php");require_once "func/isnewday.php";isnewday(3);function analyse(){    $gilden=array();    $sql="SELECT `gildenid` FROM `gilden`";    $result=db_query($sql);    while ($row = db_fetch_assoc($result)) {        $gilden[$i]=(int)$row['gildenid'];        $i++;    }    $gut=0;    $fehl=0;    $sql="SELECT `guild` FROM `gildenbuch`";    $result=db_query($sql);    while ($row = db_fetch_assoc($result)) {        if(in_array((int)$row['guild'],$gilden)){            $gut++;        }else{            $fehl++;        }        $j++;    }    return array($j, $gut, $fehl);}page_header("Gildenbucheinträge");switch($_GET['op']){    case "delete":        $gilden=array();        $sql="SELECT `gildenid` FROM `gilden`";        $result=db_query($sql);        while ($row = db_fetch_assoc($result)) {            $gilden[$i]=(int)$row['gildenid'];            $i++;        }        $gut=0;        $fehl=0;        $sql="SELECT `id`,`guild` FROM `gildenbuch`";        $result=db_query($sql);        while ($row = db_fetch_assoc($result)) {            if(in_array((int)$row['guild'],$gilden)){                $gut++;            }else{                $fehl++;                db_query("DELETE FROM `gildenbuch` where `id`=".(int)$row['id'].";");            }            $j++;        }        output("`&".$fehl." Einträge wurden gelöscht`n");        addnav('Zurück','su_gildenbuch.php?');    break;    default:        list($j, $gut, $fehl)=analyse();        output("`@`b`cEinträge der Gildenbücher`c`b`n`n`7Anzahl Einträge gesamt: `@".$j."`n`7Von existierenden Gilden: `@".$gut."`n`7Von gelöschten Gilden: `@".$fehl."`n`n");        if($fehl>0) addnav('unnütze Einträge löschen','su_gildenbuch.php?op=delete');        else output("<table align='center'><tr><td colspan=3 align='center'>`&`i`bKeine Einträge von gelöschten Gilden!`b`i`0</td></tr></table>",true);    break;}addnav("G?Zurück zur Grotte","superuser.php");addnav("W?Zurück zum Weltlichen","village.php");output("`n<div align='right'>`72009 by Linus</div>",true);page_footer();?>

