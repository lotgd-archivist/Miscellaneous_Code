
<?phprequire_once "common.php";global $session, $rporte;//Gleichnamige Variable aus der viewcommentary();$return = $_GET['return'];$section=$_GET[section];if (in_array($section,$rporte)) {    $sql = "SELECT `comment` FROM `commentary` WHERE `author` = ".$session[user][acctid]." AND `section` = '".$section."' ORDER BY postdate DESC LIMIT 1 ";    $result = db_query($sql) or die(db_error(LINK));    $row = db_fetch_assoc($result);    db_free_result($result);    $points=floor(strlen($row['comment'])/128);    if($points<1 && strlen($row['comment'])>=128) $points=1;    $session['user']['rp_points']-=$points;    if ($session[user][rp_only]>0){        $session[user][donation]-=$points;        if($points>0){            (int)$halbe=floor($points/2);            if($halbe<=1){                $session['guild']['gildenpunkte']--;                db_query("UPDATE gilden SET gildenpunkte=gildenpunkte-1 WHERE gildenid='".$session['user']['memberid']."'");            }else{                $session['guild']['gildenpunkte']-=$halbe;                db_query("UPDATE gilden SET gildenpunkte=gildenpunkte-".$halbe." WHERE gildenid='".$session['user']['memberid']."'");            }        }    }}$sql = "DELETE FROM `commentary` WHERE `author` = ".$session[user][acctid]." AND `section` = '".$section."' ORDER BY postdate DESC LIMIT 1 ";db_query($sql);$return = preg_replace("'[&?]c=[[:digit:]-]+'","",$return);$return = substr($return,strrpos($return,"/")+1);redirect("$return");

