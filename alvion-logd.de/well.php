
<?php/** Author:        Chaosmaker* Email:                webmaster@chaosonline.de* * Purpose:        Well for throwing keys in*                * Features:        Throw key into well, chat** Keys thrown into this well are lost** Geänderte Version für alvion-logd.de/logd * von Linus in 08/2009*/require_once("common.php");require_once("func/systemmail.php");addcommentary();checkday();page_header("Der Dorfbrunnen");$session['user']['standort']="Dorfbrunnen";if(!isset($_GET['op']) || $_GET['op']=='abort'){    if ($session[user][gold]>1) addnav("Goldstück hineinwerfen","well.php?op=throwgold");    addnav("Z?Zurück","wohnviertel.php");    addnav("u?Zurück ins Dorf","village.php");}if ($_GET['op']=='abort'){    unset($_SESSION['tmp']['throwname']);    unset($_SESSION['tmp']['throwowner']);}if ($_GET['op']!='throwkey2' && $_GET['op']!='throwgold'){    // Eigene Schlüssel einlesen    $result = db_query('SELECT items.value1,houses.housename,houses.owner FROM items LEFT JOIN houses ON houses.houseid=items.value1 WHERE items.class="Schlüssel" AND items.owner='.$session[user][acctid].' AND houses.owner != '.$session[user][acctid].' ORDER BY houses.housename ASC');    if (db_num_rows($result) > 0) {        $num = 0;        while ($row = db_fetch_assoc($result)) {                            $eigner=db_fetch_assoc(db_query('SELECT `name`, `login` FROM `accounts` WHERE `acctid`='.$row['owner']));            if ($_GET['op']=='throwkey' && $_GET['house']==$row['value1']){                $_SESSION['tmp']['throwname'] = $row['housename'];                $_SESSION['tmp']['throwowner'] = $eigner['name'];            }            else {                if ($num==0) {                    $num++;                    if ($_GET['op']!='throwkey') addnav('Schlüssel wegwerfen');                }                if ($_GET['op']!='throwkey'){//                    addnav($row['housename'].'`0, '.$eigner['login'],'well.php?op=throwkey&house='.$row['value1']);                    addnav($row['housename'].'`0','well.php?op=throwkey&house='.$row['value1']);                }            }        }    }}// Schlüssel wegwerfenif ($_GET['op']=='throwkey' && !isset($_GET['comscroll']) && $_POST['section']=="") {    output('`$Willst du den Schlüssel für `^'.$_SESSION['tmp']['throwname'].'`$, das Haus von `^'.$_SESSION['tmp']['throwowner'].'`$, wirklich in den Brunnen werfen?');    addnav("J?Ja! Wegwerfen!","well.php?op=throwkey2&house=".$_GET['house']);    addnav("N?Halt! Nein!","well.php?op=abort");}elseif ($_GET['op']=='throwkey2' && !isset($_GET['comscroll']) && $_POST['section']=="") {    output('`FDu wirfst den Schlüssel für `^'.$_SESSION['tmp']['throwname'].'`F in den Brunnen und wartest lange auf das Platschen.`nDer Brunnen muss sehr tief sein.');    $owner=db_fetch_assoc(db_query('SELECT `owner` FROM `houses` WHERE `houseid`='.(int)$_GET['house']));    db_query('UPDATE items SET owner=0 WHERE class="Schlüssel" AND owner='.$session['user']['acctid'].' AND value1='.(int)$_GET['house']) or die(db_error(LINK));    $msg = $session['user']['name'].'`7 hat den Schlüssel zu deinem Haus '.$_SESSION['tmp']['throwname'].'`7 in den Dorfbrunnen geworfen!';    systemmail($owner['owner'],"`2Schlüssel verloren!`2",$msg);            addnav("Zurück","well.php");}elseif ($_GET['op']=="throwgold" && !isset($_GET['comscroll']) && $_POST['section']==""){    $time=(e_rand(1,10)/2);            output("`FDu wirfst eines deiner Goldstücke hinein und zählst die Sekunden. Nach `^".(strtr($time,'.',','))."`F Sekunden hörst du es platschen.");    $session[user][gold]--;    addnav("Zurück","well.php");}else {    output('`FDu gehst durch die Gassse, die zu den Häusern führt, als dir etwas am Rande der Gasse auffällt. '        .'Aufmerksam näherst du dich dem Etwas und stellst fest, dass es ein Brunnen ist!`n'        .'Neugierig untersuchst du ihn genauer. Wie tief er wohl sein mag?'        .'`n`n`FUm den Brunnen herum stehen einige Leute.`n');    viewcommentary("well","Mit Umstehenden reden:",25,"sagt",1,1);}page_footer();?>

