
<?php#-----------------------------------------##   Gildensystem Version: 1.5b            ##   ~~ Gildenstrasse ~~                   ##   Autor: Eliwood, Serra                 ##-----------------------------------------#/* Require */require_once "common.php";require_once "lib/gilden.php";require_once "func/systemmail.php";/* Gilde laden und speichern in $session['guild'] */loadguild($session['user']['memberid']);page_header();addcommentary();/* Start Switch */switch($_GET['op']):  /* Gildenstrasse */  case "":  case "search":    page_header("Gildenstrasse");    output("`c`b`jG`Úi`Ól`Íd`Ée`Yns`Ét`Ír`Óa`Úß`je`b`c`n`n`n"        ."`YDu be`Étritt`Íst ei`Óne St`Úraße, `jin de`Úr Alle`Ós ein `Íwenig `Éander`Ys aus`Ésieht`Í, als `Óin de`Ún übr`jigen `ÚStraß`Óen un`Íd Gas`Ésen A`Ylvion`És. St`Íaune`Ónd b`Úleibs`jt du `Ústehe`Ón. Gr`Íoße, `Éhohe `YGebäu`Éde r`Éeihen `Ísich `Óanein`Úander`j, die `Úalle `Ódem g`Íleich`Éen Zw`Yeck z`Éu die`Ínen s`Óchein`Úen. A`jls du `Údiese `ÓHäuse`Ír ent`Élang `Yschre`Éitest`Í, kann`Óst du `Úfest `jstell`Úen, d`Óass e`Ís sic`Éh um `Ydie `ÉGilde`Ínstra`Óße ha`Úndelt`j. `n"        ."`jHier `Úfinde`Óst du`Í alle `ÉGilde`Yn, di`Ée in `Í Alvio`Ón ge`Úgründ`jet wo`Úrden `Ósind.`n`n");    /* Wenn User Mitglied in Gilde ist */    if($session['user']['memberid']>0)    {      $session['rank'] = db_fetch_assoc(db_unbuffered_query("SELECT * FROM gildenranks WHERE rankid='{$session['user']['rankid']}' LIMIT 1"));        output("`YDu wendest einen Blick auf deinen Gildenausweis. Darauf sind die Gilde und die "            ."Hausnummer der Gilde, sowie der Rang verzeichnet:`n`n");      output("`YGilde: `^".$session['guild']['gildenname']."`n");      output("`YGildenstrasse Nummer: `^".$session['guild']['gildenid']."`n");      output("`YRang: `^".($session['user']['rankid']!=0?$session['rank']['rankname']:"Ranglos")."`n");    }    /* Wenn nicht, aber auch keine Bewerbung abgegeben wurde */    elseif(!$session['user']['gildenactive'])    {      output("`YNeugi`Éerig `Íbetra`Óchtes`Ít du `Édie S`Ychild`Éer, d`Íie ü`Óber d`Íen je`Éweili`Ygen E`Éingän`Ígen d`Óer Ge`Íbäude `Éangeb`Yracht `Ésind, `Íund l`Óiest `Ídie e`Éinlad`Yenden `ÉTexte`Í.`n`n");      output("`jWirst `Údu di`Óch en`Ítsche`Óiden, `Úeiner `ÚGilde `jbei z`Úu tre`Óten, `Íoder `Ówills`Út du `jviell`Úeicht `Ósogar `Íselbs`Ót ein`Úe grü`jnden?`n`n");    }    /* Wenn nichts zutrifft, also User  sich beworben hat, aber noch nicht aufgenommen wurde */    else    {      output("`YDu hast noch keine Antwort erhalten, ob du aufgenommen wurdest. Warte einfach noch ein wenig, ja?");    }    output("`n`n");    /* Navigation */    addnav("Die Gildenstrasse");    addnav("Gildenverwaltung","gildenstrasse.php?op=verwaltung");    addnav("Aktuelle Gilden","gildenstrasse.php?op=brett");    /* Wenn Mitglied einer Gilde */        viewcommentary("gildenstrasse","Hinzufügen:",25,"sagt",1,1);        if($session['user']['memberid']>0)      addnav("Gilde betreten","gilden.php");    break;  /* Verwaltung */  case "verwaltung":    /* Seitentitel */    page_header("Verwaltungshaus");    output("`YDu betrittst das Verwaltungshaus der Gilden. Hier müssen die Gilden gegründet werden, "          ."damit sie offiziell anerkannt werden, hier werden Bewerbungen für die verschiedenen Gilden "          ."abgegeben, und hier liegt das Archiv der Gildengeschichte Alvions, zu dem nur hochrangige "          ."Gildenmitglieder Zugang haben.`n`n");    /* Wenn User weder Mitglied, noch eine Bewerbung abgeschickt hat. */    if($session['user']['memberid']==0 && !$session['user']['gildenactive'])    {      addnav("Aktionen");      addnav("Bewerben","gildenstrasse.php?op=bewirb");      output("`ÍEin Mann erklärt dir, dass du dich bei einer Gilde bewerben kannst");      /* Wenn User mehr Drachenkills als Eingestellt hat, darf er eine Gilde gründen */      if($session['user']['dragonkills']>=dkrequired || ($session['user']['rp_only'] && $session['user']['rp_points']>=500))      {        addnav("Gilde gründen","gildenstrasse.php?op=grund");        output(", oder aber auch, sofern du genügend Bares hast, eine eigene Gilde gründen");      }      $output.=".<br><br>";    }    output("`YAn einer Tafel hängen die momentanen Preise: ");    /* Preistafel anzeigen */    preistafel();    break;  /* Bewerben */  case "bewirb":    page_header("Verwaltungshaus");    // addnav("Aktualisieren","gildenstrasse.php?op=bewirb");    showguilds(false,"gildenstrasse.php?op=bewirb2");    addnav("Abbrechen","gildenstrasse.php?op=verwaltung");    break;  case "bewirb2":    page_header("Verwaltungshaus");    /* Die entsprechende Gilde abrufen */    $sql2 = "SELECT * FROM gilden WHERE gildenid='".addslashes($_GET['id'])."' LIMIT 1";    $result = db_query($sql2);    $row = db_fetch_assoc($result);    /* Eventuelle Multiaccounts checken */    $sql3 = "SELECT uniqueid,acctid FROM accounts WHERE acctid='$row[leaderid]'";    $row2 = db_fetch_assoc(db_query($sql3));    /* Check heil überstanden? */    if(ac_check($row2)==false)    {      /* Insert vorbereiten */      $sql = "INSERT INTO `bewerbungen` (`bewerbid`,`bewerberid`,`gildenid`) ";      $sql .= "VALUES ('','".$session['user']['acctid']."','".$_GET['id']."');";      /* Und in die Datenbank schreiben */      db_query($sql);      /* Mail vorbereiten */      $subject = "Bewerbung!";      $body = "`&".$session['user']['name']."`% hat sich bei deiner Gilde beworben.";//      $body =mysqli_real_escape_string($mysqli, $body);      /* Und abschicken *///      db_unbuffered_query("INSERT INTO mail (msgfrom,msgto,subject,body,sent) VALUES (0,'$row[leaderid]','$subject','$body',now())");            systemmail($row['leaderid'],$subject,$body);                  /* Ausgabe */      output("`#Du hast eine Bewerbung bei der Gilde ".$row['gildenname']."`# abgegeben. Warte "            ."noch ein Weilchen, damit dich der Führer aufnehmen oder auch ablehnen kann.");      /* Merkmal, dass User sich beworben hat, setzen */      $session['user']['gildenactive'] = '1';    }    /* Check doch nicht überstanden? Och... Mach trotzdem was sinnvolles ;) */    else    {      output("Da der Führer dieser Gilde mit dir verwandt ist, darfst du dich nicht bei dieser Gilde bewerben!");    }    break;  /* Gründen */  case "grund":    /* 2ter Schritt */    page_header("Verwaltungshaus");    output("`#Der Mann gibt dir ein Formular und meint nur: \"`^Füll aber alles ordentlich aus!`#\"`n`n");    /* Formular */    grundform("gildenstrasse.php?op=grund2");    break;  case "grund2":    /* 1ter Schritt */    page_header("Verwaltungshaus");    /* Eingabe prüfen, hehe */    if(check_input($_POST)==false)    {      /* Och... Nicht überstanden, hmm? Formular also wieder geben.... Inkl. Error, natürlich ;) */      rawoutput($error);      grundform("gildenstrasse.php?op=grund2");    }    else    {      /* Juhui, geschafft =D Nun nur noch Gold prüfen *gg* */      output("`#Du gibst dem Mann das Formular zurück, er sieht es sich kurz an und meint dann, mit einem Blick auf deine Ersparnisse gerichtet: ");    if(!$session['user']['rp_only']){          if($session['user']['gold']>=goldprice && $session['user']['gems']>=gemprice)          {            /* Ah... Der Spieler genügt den hohen Anforderungen, jaja... Also, gebt ihm eine Gilde =D */            output("\"`^Gut... Dann unterzeichne noch hier, und die Gründung wird erfolgreich abgeschlossen.`#\"");            /* Abrechnen, jaja */            $session['user']['gold']-=goldprice;            $session['user']['gems']-=gemprice;            /* Gründerid setzen ;) */            $session['user']['isleader'] = highestleader;            /* Jaja... User ist Gildenaktiv (Nein, kommt nicht von radioaktiv, sondern von Hyperaktiv *gg*) */            $session['user']['gildenactive'] = '1';            /* Gildeninsert vorbereiten... Der kommt irgendwann mal in eine Funktion ô__Ò */            $sql = "INSERT INTO `gilden` (`gildenname`,`gildenname_b`,`gildenprefix`,`gildenprefix_b`,`leaderid`)";            $sql.= "VALUES ('".$_POST['gildenname']."','".$_POST['gildenname_b']."','".$_POST['gildenprefix']."','".$_POST['gildenprefix_b']."','".$session['user']['acctid']."')";            /* Schreiben oder Schreien... */            db_query($sql);            /* Jaja... Die ID der Gilde brauchen mer noch =) */            $sql = "SELECT gildenid FROM gilden WHERE leaderid='{$session['user']['acctid']}' ";            $id = db_fetch_assoc(db_unbuffered_query($sql));            /* Und da haben wir sie... Gleich dem User zuweisen, jaja */            $session['user']['memberid']=$id['gildenid'];          } else {            /* Tjo... Betrug, und da wird schonmal unfreundlich zurück gewiesen.               Kostet ja schliesslich alles Geld. Das Haus, die Waffen, das Wappen.... ;) */            output("\"`^Dein Geld reicht nicht... Komm wieder, wenn du genug hast!`#\"");          }    } else {          if($session['user']['rp_points']>=500 && $session['user']['donation']-$session['user']['donationspent']>=200)          {            /* Ah... Der Spieler genügt den hohen Anforderungen, jaja... Also, gebt ihm eine Gilde =D */            output("\"`^Gut... Dann unterzeichne noch hier, und die Gründung wird erfolgreich abgeschlossen.`#\"");            /* Abrechnen, jaja */            $session['user']['donationspent']+=200;            /* Gründerid setzen ;) */            $session['user']['isleader'] = highestleader;            /* Jaja... User ist Gildenaktiv (Nein, kommt nicht von radioaktiv, sondern von Hyperaktiv *gg*) */            $session['user']['gildenactive'] = '1';            /* Gildeninsert vorbereiten... Der kommt irgendwann mal in eine Funktion ô__Ò */            $sql = "INSERT INTO `gilden` (`gildenname`,`gildenname_b`,`gildenprefix`,`gildenprefix_b`,`leaderid`)";            $sql.= "VALUES ('".$_POST['gildenname']."','".$_POST['gildenname_b']."','".$_POST['gildenprefix']."','".$_POST['gildenprefix_b']."','".$session['user']['acctid']."')";            /* Schreiben oder Schreien... */            db_query($sql);            /* Jaja... Die ID der Gilde brauchen mer noch =) */            $sql = "SELECT gildenid FROM gilden WHERE leaderid='{$session['user']['acctid']}' ";            $id = db_fetch_assoc(db_unbuffered_query($sql));            /* Und da haben wir sie... Gleich dem User zuweisen, jaja */            $session['user']['memberid']=$id['gildenid'];          } else {            /* Tjo... Betrug, und da wird schonmal unfreundlich zurück gewiesen.               Kostet ja schliesslich alles Geld. Das Haus, die Waffen, das Wappen.... ;) */            output("\"`^Deine Punkte reichen nicht... Komm wieder, wenn du genug hast!`#\"");          }    }    }    break;  case "brett":    /* Alle Gilden anzeigen? ô__Ò       ...       ...       Na gut, da hast du sie, aber lass mich nu in Ruhe, mag nicht mehr :( */    showguilds(false,false,true);    break;  default:    /* Tjo, wenn das zu sehen ist, ist wirklich was schief gelaufen... Verschrieben? */    page_header("FEHLER!");    output("`\$Fehler! Melde es unverzüglich den Administratoren, wenn du das sehen kannst");/* End Switch */endswitch;/* Back */addnav("Zurück");if(isset($_GET['op']))addnav("Gildenstrasse","gildenstrasse.php");addnav("Zurück ins Dorf","village.php");/* Und fertig, hihi */page_footer();

