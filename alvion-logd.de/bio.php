
<?php// 29012009require_once "common.php";require_once "func/kampfkunst.php";require_once "func/remove_evil_tags.php";require_once "func/tattoos.php";checkday();$result = db_query("SELECT * FROM accounts WHERE login='$_GET[char]'");$row = db_fetch_assoc($result);$result1 = db_query("SELECT * FROM bio WHERE acctid='$row[acctid]'");$row1 = db_fetch_assoc($result1);$row[login] = rawurlencode($row[login]);$config=unserialize($row['donationconfig']);$pprefs=unserialize($row['prefs']);page_header("Charakter Biographie: ".preg_replace("'[`].'","",$row[name]));$specialty=array(0=>"nicht spezifiziert","Dunkle Künste","Mystische Kräfte","Diebeskunst","Feuer Künste","Weiße Magie");$gesinnung=array(1=>"Chaotisch Gut", 2=>"Rechtschaffen Gut", 3=>"Neutral", 4=>"Rechtschaffen Böse", 5=>"Chaotisch Böse", 6=>"Chaotisch Neutral", 0=>"`)Unbekannt");$gott=array(1=>"Tempus",2=>"Mielikki",3=>"Shar",4=>"Deneir",5=>"Ramius",6=>"Bahamut",7=>"Idun",8=>"Mystra",0=>"`)Keiner");$orden_name=array(0=>"","Orden des Wassers","Orden des Feuers","Orden des Windes","Orden der Erde","Orden des Schattens","Orden des Lichtes"                        ,"Orden des Todes","Orden des Lebens","Orden des Äthers","Orden des Phoenix","Orden der Liebe","Orden des Glücks"                        ,"Orden der Zuversicht","Orden der Treue","Orden der Morgenröte","Orden des Raureifs","Orden des Drachen","Orden des Dämonenreichs"                        ,"Orden des Engelreiches","Orden des Untergangs","Orden der Auferstehung","Orden der Vergangenheit","Orden der Zukunft",                        "Orden der Gegenwart");$orden_farbe=array(0=>"", 1=>"`4", 2=>"`$", 3=>"`Q", 4=>"`q", 5=>"`X", 6=>"`_", 7=>"`&",                    8=>"`Á", 9=>"`D", 10=>"`(", 11=>"`9", 12=>"`m", 13=>"`M", 14=>"`é",                    15=>"`x", 16=>"`Z", 17=>"`]", 18=>"`=", 19=>"`8", 20=>"`g", 21=>"`2",                    22=>"`B", 23=>"`C", 24=>"`z");output("`^Biographie für $row[name]",true);if ($session[user][loggedin]) output("<a href=\"mail.php?op=write&to=$row[login]\" target=\"_blank\" onClick=\"".popup("mail.php?op=write&to=$row[login]").";return false;\"><img src='images/newscroll.GIF' width='16' height='16' alt='Mail schreiben' border='0'></a>",true);if (getsetting("avatare",0)==1){    if ($row1[avatar]){        $pic_size = @getimagesize($row1[avatar]);        $pic_width = $pic_size[0];        $pic_height = $pic_size[1];        output("<table><tr><td valign='top'>`n`n<img src=\"$row1[avatar]\" ",true);        if (($pic_width > 400 || $pic_height > 400) && $pic_width > $pic_height) {            output("width=\"400\" ",true );            $pic_height=floor(400/$pic_width*$pic_size[1]);            output("height=\"".$pic_height."\" ",true );        } elseif (($pic_width > 400 || $pic_height > 400) && $pic_height > $pic_width) {            output("height=\"400\" ",true );                   $pic_width=floor(400/$pic_height*$pic_size[0]);            output("width=\"".$pic_width."\" ",true );        } elseif (($pic_width > 400 || $pic_height > 400) && $pic_height == $pic_width) {            output("width=\"400\" ",true );            output("height=\"400\" ",true );        }        output("alt=\"".preg_replace("'[`].'","",$row[name])."\">&nbsp;</td><td valign='top'>",true);    } else {        output("<table><tr><td>(kein Bild)&nbsp;&nbsp;&nbsp;</td><td>",true);    }}if (!$row['rp_only']) output("`n`n`^Titel: `@$row[title]`n");if (getsetting("activategamedate","0")==1 && $row[birthday]!="") output("`^Geburtstag: `@$row[birthday]`n");if (!$row['rp_only']) output("`^Level: `@$row[level]`n");if (!$row['rp_only']) output("`^Alter seit DK: `@$row[age]`^ Tage`n");if (!$row['rp_only']) output("`^Wiedererweckt: `@$row[resurrections]x`n");output("`^Rasse: `@{$row[race]}`n");output("`^Geschlecht: `@".($row[sex]?"Weiblich":"Männlich")."`n");output("`^Kampfart: `@".$kampfkunst[$row[kunst]]."`n");if (strlen($row1['klasse'])>1) output("`^Klasse: `@".$row1[klasse]."`n");if (!$row['rp_only']) output("`^Spezialgebiet: `@".$specialty[$row[specialty]]."`n");output("`^Gesinnung: `@".$gesinnung[$row[gesinnung]]."`n");if($row['gott']>0){    if($row1['gottname']==""){        output("`^Gottheit: `@".$gott[$row['gott']]."`n");    }else{        output("`^Gottheit: {$row1['gottname']}`@`n");    }}$sql = "SELECT mountname FROM mounts WHERE mountid='{$row['hashorse']}'";$result = db_query($sql);$mount = db_fetch_assoc($result);if ($mount['mountname']=="")      $mount['mountname'] = "`iKeines`i";if($row1[tiername]==""){    output("`^Begleiter: `@{$mount['mountname']}`n");}else{    output("`^Begleiter: `@{$row1['tiername']}");    output("`n");}if (strlen($row1['weaponname'])>1) output("`^Waffe: `@{$row1['weaponname']}`n");if (strlen($row1['armorname'])>1) output("`^Rüstung: `@{$row1['armorname']}`n");if ($row['dragonkills']>0 && !$row['rp_only']) output("`^Drachenkills: `@{$row['dragonkills']}`n");if($row['orden']>0){    if($session['user']['prefs']['ordenshort'] || $pprefs['ordenshort']){        output("`^Orden: `@$row[orden]`n");    }else{        $o_out.="`^Orden: ";        for ($i=1;$i<=$row['orden'];$i++){            $o_out.=$orden_farbe[$i].$orden_name[$i];            if($i<$row['orden'])    $o_out.="`^, ";        }        output($o_out."`n");    }}if (!$row['rp_only']) output("`^Bester Angriff: `@$row[punch]`n");output("<table border='0' cellspacing='0' cellpadding='0'><tr><td>`^Ansehen:&nbsp;</td><td>".grafbar(100,($row['reputation']+50),100,12)."</td></tr></table>",true);if ($row[housekey]) output("`^Hausnummer: `@$row[housekey]`n");output("`^RPG-Punkte: `@$row[rp_points]`n");if ($row[marriedto]){    if ($row[marriedto]==4294967295){        output("`^Verheiratet mit: `@".($row[sex]?"Seth":"Violet")."`n");    }elseif ($row[charisma]==4294967295){        $sql = "SELECT name FROM accounts WHERE acctid='{$row['marriedto']}'";        $result = db_query($sql);        $partner = db_fetch_assoc($result);        output("`^Verheiratet mit: `@{$partner['name']}`n");    } elseif (($row[marriedto]>0) && ($row[fragen]==5)){        $sql = "SELECT name FROM accounts WHERE acctid='{$row['marriedto']}'";        $result = db_query($sql);        $partner = db_fetch_assoc($result);        output("`^Verlobt mit: `@{$partner['name']}`n");    }}if($row[$ssstatus] > 0 && $row[ssmonat] <= 22){    output("`^Ist Schwanger`n");}if($row[sex]) $sqlkin = "SELECT * FROM kinder where mama='".$row[acctid]."' ORDER BY id ASC";else $sqlkin = "SELECT * FROM kinder where papa='".$row[acctid]."' ORDER BY id ASC";$resultkin = db_query($sqlkin);$kinder = array();while ($rowkin = db_fetch_assoc($resultkin)){    if($rowkin['name']!='')    array_push($kinder, $rowkin['name']);}if($kinder[0] != ""){    if($row[sex]) output("`^Ist Mutter von:`@ ");    else output("`^Ist Vater von:`@ ");    output(implode(", ", $kinder),true);    output("`0`n");}/* Gildenaddon by Eliwood für Eliwoods Gilden */if($row['memberid']>0) {    $sql = "SELECT gildenid,gildenname,gildenprefix FROM gilden WHERE gildenid = '".$row['memberid']."' LIMIT 1";    $gilde = db_fetch_assoc(db_query($sql));    output("`^Gildenmitgliedschaft: `@".$gilde['gildenname']."`@ [`0<a href='showdetail.php?id=".$gilde['gildenid']."' target='window_popup' onClick=\"".popup("showdetail.php?id=".$gilde['gildenid'])."; return false;\">`&".stripslashes($gilde['gildenprefix'])."`&</a>`@]`n",true);    if($gilde['gildenid']==123 || $gilde['gildenid']==150 || $gilde['gildenid']==156){    }else{        $sql = "SELECT rankname FROM gildenranks WHERE rankid = '".$row['rankid']."' LIMIT 1";        $rank = db_fetch_assoc(db_query($sql));        output("`^Rang: `@".$rank['rankname']."`@`n");    }}if ($row['acctid']==getsetting("hasring",0)){    output("`^Besitzt den `SRing der Schatten`n");}if ($row['acctid']==getsetting("hasamulett",0)){    output("`^Besitzt das Amulett der Macht`n");}if ($row['stones']>0){    $sql="SELECT stonename FROM stones WHERE stone='".$row['stones']."'";    $ring=db_fetch_assoc(db_query($sql));    if($row['stones']==18)    output("`^Ist im Besitz von ".$ring['stonename']."`n");    else output("`^Besitzt den ".$ring['stonename']."`n");}// Passierschein A38$p38="SELECT * FROM items WHERE owner='".$row['acctid']."' AND class='Dokument' AND name='Passierschein A38'";$result = db_query($p38);if (db_num_rows($result)>0) output("`^Besitzt einen Passierschein`n");if ($row['pvpflag']=="5013-10-06 00:42:00") output("`4`iSteht unter besonderem Schutz`i");if (getsetting("avatare",0)==1)output ("</td></tr></table>",true);//Herotattoos by Linus & Veskaraif ($row[herotattoo]) {        $out_tattoo="<table align='center'><tr><td>`^Tätowierungen:</td></tr></table><table border=0 cellpadding=2 cellspacing=1 >";        $maxtattoos=count($ghosts);    //Hier die Anzahl aller existierenden Tattoos eintragen <- hat sich erledigt! Nicht mehr nötig! :D        $maxperrow=10;        //Hier die Anzahl für eine Zeile eintragen        for($i=0;$i<=floor($maxtattoos/$maxperrow);$i++) {                $out_tattoo.="<tr style='text-align:center'><td style='width:70px'>";                for($j=$i*$maxperrow+1; $j<=$row['herotattoo'] && $j<=$i*$maxperrow+$maxperrow ;$j++){                        if($j>$maxtattoos) break;                        $out_tattoo.=$ghosts[$j][0]."</td>";                        if ($j<$row[herotattoo]) $out_tattoo.="<td  style='width:70px'>";                }                $out_tattoo.="</tr><tr style='text-align:center'><td style='width:70px'>";                for($j=$i*$maxperrow+1; $j<=$row['herotattoo'] && $j<=$i*$maxperrow+$maxperrow ;$j++){                        if($j>$maxtattoos) break;                        $this_tattoo = "images/".$ghosts[$j][1].".gif";                        $out_tattoo.="<img src=\"$this_tattoo\"></img></td>";                        if ($j<$row[herotattoo]) $out_tattoo.="<td  style='width:70px'>";                }                $out_tattoo.="</tr>";                if($i<floor($maxtattoos/10)) $out_tattoo.="<tr style='text-align:center'><td style='width:70px'>";        }        $out_tattoo.="</table>";        output($out_tattoo,true);}if ( !empty( $row1['bio'] ) ) {    if ( empty( $row1['nl2br_enabled'] ) ) {        $bio = soap( $row1['bio'] );    }    else {        $bio = soap( nl2br ( str_replace( '`n' , '' , $row1['bio'] ) ) );    }    output( '`n`n`n'.removeEvilTags($bio,false).'`n`n`n',true);}// BEGIN MOUNTBIO FOR BLACKROSE umgeschrieben und modifiziert für Silienta by Rikkarda@silienta-logd.de angepasst für Alvion von Linus in 2007if ($row[hashorse] && (strlen($row1[tiername])>1 || $row1[mountavatar] != "" || strlen($row1[mountbio])>1)){    output("<table><tr>",true);    output( "<td>`n`n`^Begleiterinfo ",true);    if (strlen($row1[tiername])>1) {        output("`^für `&" . $row1['tiername'],true);    }    output("`0</td></tr><tr align=center>",true);    if (getsetting("avatare",0)==1){        if ($row1['mountavatar'])  {            $pic_size = @getimagesize($row1[mountavatar]);            $pic_width = $pic_size[0];            $pic_height = $pic_size[1];            output("<td>`n<img src=\"$row1[mountavatar]\" ",true);            if (($pic_width > 400 || $pic_height > 400) && $pic_width > $pic_height) {                output("width=\"400\" ",true );                $pic_height=floor(400/$pic_width*$pic_size[1]);                output("height=\"".$pic_height."\" ",true );            } elseif (($pic_width > 400 || $pic_height > 400) && $pic_height > $pic_width) {                output("height=\"400\" ",true );                       $pic_width=floor(400/$pic_height*$pic_size[0]);                output("width=\"".$pic_width."\" ",true );            } elseif (($pic_width > 400 || $pic_height > 400) && $pic_height == $pic_width) {                output("height=\"400\" ",true );                output("height=\"400\" ",true );            }            output("alt=\"".preg_replace("'[`].'","",$row1[tiername])."\">&nbsp;</td>",true);        }    }    output("</tr></table>",true);    if ( $row1[mountbio] != "" ) {        output("`n`^Beschreibung:`0 `n`n".soap(removeEvilTags($row1['mountbio'],false))."",true);    }}// END MOUNTBIO//RPG-Chars Addon (c) 2006 by Meralou & Alexiel modifiziert von Linus in 2007if ($row['rp_only']==1) output("`n`^$row[name] `^ist ein RPG-Char`n");if ($session['user']['superuser'] >= 3) {    output("<form action='bio.php?op=delete&char=$_GET[char]&ret=".$_GET[ret]."' method='POST'>",true);    if (!empty($row1['avatar'])){        output("<input type='submit' class='button' name='avatar' value='Avatar löschen' onClick='return confirm(\"Avatar von {$row['login']} wirklich löschen?\");'>",true);    }    if (!empty($row1['bio'])){        output("<input type='submit' class='button' name='bio' value='Bio löschen' onClick='return confirm(\"Bio von {$row['login']} wirklich löschen?\");'>",true);    }    if (!empty($row1['mountavatar'])){        output("<input type='submit' class='button' name='mountavatar' value='TierAva löschen' onClick='return confirm(\"Tieravatar von {$row['login']} wirklich löschen?\");'>",true);    }    if (!empty($row1['mountbio'])){        output("<input type='submit' class='button' name='mountbio' value='Tierbio löschen' onClick='return confirm(\"Tierbio von {$row['login']} wirklich löschen?\");'>",true);    }    output("</form>",true);    addnav("","bio.php?op=delete&char=$_GET[char]&ret=".$_GET[ret]);}if($_GET['op']=='delete'){    if ($_POST['avatar']!=""){        $sqldel="UPDATE `bio` SET `avatar`='' WHERE `acctid`=".$row['acctid']."";    } else if ($_POST['bio']!=""){        $sqldel="UPDATE `bio` SET `bio`='' WHERE `acctid`=".$row['acctid']."";    } else if ($_POST['mountavatar']!=""){        $sqldel="UPDATE `bio` SET `mountavatar`='' WHERE `acctid`=".$row['acctid']."";    } else if ($_POST['mountbio']!=""){        $sqldel="UPDATE `bio` SET `mountbio`='' WHERE `acctid`=".$row['acctid']."";    }    db_query($sqldel);    redirect("bio.php?char=$_GET[char]&ret=".$_GET[ret]);}$dummy=$_GET[ret];if(strpos($_GET['ret'],'forest.php')===FALSE &&  strpos($_GET['ret'],'hoehle.php')===FALSE && strpos($_GET['ret'],'berge.php')===FALSE)    addnav("Leistungen und Niederlagen","leistungen.php?char=".$row['acctid']."");if($_GET['back']!=""){    addnav("Zurück",$_GET['back']);}elseif ($_GET['ret']!=""){    $return = preg_replace("'[&?]c=[[:digit:]-]+'","",$_GET['ret']);    $return = substr($return,strrpos($return,"/")+1);    addnav("Zurück",$return);}else{    addnav("Zur Liste der Krieger","list.php");}page_footer();

