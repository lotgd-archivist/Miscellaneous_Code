
<?php#----------------------------------##   Gildenadmintool - Version 1.1  ##   Autor: Eliwood|Serra- 2005     ##----------------------------------#/* Wichtige (!) Dateien einbinden */require_once "common.php";require_once "func/isnewday.php";require_once "lib/gildentoolfunc.php";require_once "lib/gilden.php";require_once "lib/formulaclass.php";/* Superuserbefugnis checken */isnewday(3);/* Seitentitel */page_header("Gildeneditor");switch($_GET['op']):  case "":    output("`c`bGildeneditor`b`c`n");    output("Hier darfst du die Grundwerte der Gilden ändern, Kostenlos Gilden erstellen, Gilden aktivieren und dieselbigen blockieren, sowie löschen.");    break;  case "create":    if(!isset($_POST['gildenname']))    {      grundform("gildentool.php?op=create",true);    }    else    {      if(check_input_su()==false)      {        rawoutput($error);        grundform("gildentool.php?op=create",true);      }      else      {        $sql = "INSERT INTO `gilden` (`gildenname`,`gildenname_b`,`gildenprefix`,`gildenprefix_b`,`leaderid`)";        $sql.= "VALUES ('".$_POST['gildenname']."','".$_POST['gildenname_b']."','".$_POST['gildenprefix']."','".$_POST['gildenprefix_b']."','".$_POST['leaderid']."')";        db_query($sql);        $guildid = db_fetch_assoc(db_query("SELECT gildenid FROM gilden WHERE leaderid='".$_POST['leaderid']."'"));        db_unbuffered_query("UPDATE accounts SET gildenactive='1',memberid='".$guildid['gildenid']."',isleader='".highestleader."' WHERE acctid='".$_POST['leaderid']."'");        if($_POST['leaderid']==$session['user']['acctid'])        {          $session['user']['gildenactive'] = '1';          $session['user']['memberid'] = $guildid['gildenid'];          $session['user']['isleader'] = highestleader;        }        output("Gilde erfolreich erstellt!");      }    }    break;    case "showall":        showguilds_su("gildentool.php?");        break;    case "edit":        global $error,$minchar;        output("`4".$error."`0`n");        if(!isset($_POST['gildenname'])) {            output("`4".$error."`0`n");            edit_form($_GET['id'],"gildentool.php?op=edit&id=".$_GET['id']);        } elseif(check_input_su2()==false) {            output("`4".$error."`0`n");            edit_form($_GET['id'],"gildentool.php?op=edit&id=".$_GET['id']);        } else {            update_guild_su($_GET['id']);            showguilds_su("gildentool.php?");        }        break;    case "bewerber":        switch($_GET['act']){            case '':                $sql="SELECT `acctid`, `name`, `isleader`, `gildenactive`, `memberid` FROM `accounts` WHERE (`memberid`='' OR `memberid`='0') AND `gildenactive`='1' ORDER BY `acctid`";                $result=db_query($sql);                output("<table><tr><td>`^`bBewerbungen`b</td></tr>",true);                output("<form action='gildentool.php?op=bewerber' method='POST'>"                    ."<tr><td>UserID</td><td>Name</td><td>Gilde</td><td>Aktion</tr>",true);                while($row = db_fetch_assoc($result)) {                    output("<tr><td>{$row['acctid']}</td>"                        ."<td>{$row['name']}</td>",true);                    $sql2="SELECT * FROM `bewerbungen` WHERE `bewerberid`='".$row['acctid']."'";                    $result2=db_query($sql2);                    if(db_num_rows($result2)){                        $row2=db_fetch_assoc($result2);                        $row3=db_fetch_assoc(db_query("SELECT `gildenname` FROM `gilden` WHERE `gildenid`='".$row2['gildenid']."'"));                        $gilde=$row3['gildenname'];                    } else {                        $gilde="Fehlgeschlagene Bewerbung";                        $row2['gildenid']=0;                    }                    output("<td>{$gilde}</td>"                      ."<td>[<a href='gildentool.php?op=bewerber&act=einstellen&acctid=$row[acctid]&gildenid=".$row2['gildenid']."'>Einstellen</a> | "                      ."<a href='gildentool.php?op=bewerber&act=delete&acctid=$row[acctid]' onClick=\"return confirm('Willst du diese Bewerbung wirklich löschen?');\">`\$Löschen</a> ]</td>"                      ."</tr>",true );                    addnav("","gildentool.php?op=bewerber&act=einstellen&acctid=$row[acctid]&gildenid=$row2[gildenid]");                    addnav("","gildentool.php?op=bewerber&act=delete&acctid=$row[acctid]");                }                break;            case 'einstellen':                if($_GET['gildenid']){                    db_unbuffered_query("UPDATE `accounts` SET `memberid`='".$_GET['gildenid']."' WHERE `acctid`='".$_GET['acctid']."'");                    db_unbuffered_query("DELETE FROM `bewerbungen` WHERE bewerberid='".$_GET['acctid']."'");                    output("<table><tr><td>`bSpieler in die Gilde eingestellt!`b</td></tr>",true);                } else output("<table><tr><td>`bDiesen Spieler kannst du nicht einstellen, du kannst nur seine Bewerbung löschen!`b</td></tr>",true);                addnav("Zurück zur Liste","gildentool.php?op=bewerber");                break;            case 'delete':                if($_GET['acctid']){                    db_unbuffered_query("UPDATE `accounts` SET `memberid`='0',`gildenactive`='0' WHERE `acctid`='".$_GET['acctid']."'");                    db_unbuffered_query("DELETE FROM `bewerbungen` WHERE bewerberid='".$_GET['acctid']."'");                    output("<table><tr><td>`bBewerbung gelöscht!`b</td></tr>",true);                } else output("<table><tr><td>`bEs ist ein Fehler aufgetreten! Bitte dem Progger in den Hintern treten :D`b</td></tr>",true);                addnav("Zurück zur Liste","gildentool.php?op=bewerber");                break;        }        output("</form></table>",true);        addnav("Zurück","gildentool.php");        break;    case "members":        $userinfo = array(            "Mitgliedsinfo,title",            "acctid"=>"User ID,viewonly",            "name"=>"Display Name,viewonly",            "isleader"=>"Verwalter?,enum,0,einfaches Mitglied,1,Verwalter,2,Leader",            "rankid"=>"Gildenrang,int",                "gildenactive"=>"Aktiviert?,enum,0,Nein,1,Ja"            );        switch($_GET['act']){            case '':                $name=db_fetch_assoc(db_query("SELECT `gildenname` FROM `gilden` WHERE `gildenid`='".$_GET['id']."'"));                $sql="SELECT `acctid`, `name`, `isleader`, `gildenactive` FROM `accounts` WHERE `memberid`='".$_GET['id']."' ORDER BY `acctid`";                $result=db_query($sql);                output("<table><tr><td>`^`bMitglieder der Gilde ".$name['gildenname']."`b</td></tr>",true);                output("<form action='gildentool.php?op=members&act=edit' method='POST'>"                    ."<tr><td>UserID</td><td>Name</td><td>Status</td><td>Aktiv</td><td>Aktion</tr>",true);                while($row = db_fetch_assoc($result)) {                      output("<tr><td>{$row['acctid']}</td>"                          ."<td>{$row['name']}</td>",true);                          switch($row['isleader']){                              case '0':                                  output("<td>`2Mitglied`0</td>",true);                                  break;                              case '1':                                  output("<td>`6Verwalter`0</td>",true);                                  break;                              case '2':                                  output("<td>`4Leader`0</td>",true);                                  break;                        }                          output("<td>{$row['gildenactive']}</td>"                          ."<td>[<a href='gildentool.php?op=members&act=edit&acctid=$row[acctid]'>Edit</a> | "                          ."<a href='gildentool.php?op=members&act=delete&acctid=$row[acctid]&memberid=$_GET[id]' onClick=\"return confirm('Willst du diesen User aus der Gilde werfen?');\">`\$Rauswerfen</a> ]</td>"                          ."</tr>",true );                     addnav("","gildentool.php?op=members&act=edit&acctid=$row[acctid]");                    addnav("","gildentool.php?op=members&act=delete&acctid=$row[acctid]&memberid=$_GET[id]");                }                output("</form></table>",true);                addnav("Zurück","gildentool.php");                break;            case 'edit':                $sql="SELECT `acctid`, `name`, `memberid`, `isleader`, `gildenactive`, `rankid` FROM `accounts` WHERE `acctid`='".$_GET['acctid']."'";                $row=db_fetch_assoc(db_query($sql));                output("<table><form action='gildentool.php?op=members&act=save' method='POST'>",true);                output("<tr><td>UserID: ".$row['acctid']."</td></tr>",true);                output("<tr><td>Name: ".$row['name']."</td></tr>",true);                output("<input type=\"hidden\" name=\"acctid\" value=\"".$row['acctid']."\">",true);                output("<tr><td><label for=\"memberid\">Gilden-ID:</label> <input type=\"text\" name=\"memberid\" value=\"".HTMLEntities($row['memberid'])."\">",true);                  switch($row['isleader']){                      case '0':                             output("<tr><td><label for=\"isleader\">Verwalter:</label> <select name=\"isleader\" id=\"isleader\"><option selected value=\"0\">einfaches Mitglied</option> <option value=\"1\">Verwalter</option> <option value=\"2\">Leader</option></select></td></tr>",true);                          break;                      case '1':                             output("<tr><td><label for=\"isleader\">Verwalter:</label> <select name=\"isleader\" id=\"isleader\"><option value=\"0\">einfaches Mitglied</option> <option selected value=\"1\">Verwalter</option> <option value=\"2\">Leader</option></select></td></tr>",true);                          break;                      case '2':                             output("<tr><td><label for=\"isleader\">Verwalter:</label> <select name=\"isleader\" id=\"isleader\"><option value=\"0\">einfaches Mitglied</option> <option value=\"1\">Verwalter</option> <option selected value=\"2\">Leader</option></select></td></tr>",true);                          break;                }                output("<tr><td><label for=\"rankid\">Gildenrang:</label> <input type=\"text\" name=\"rankid\" value=\"".HTMLEntities($row['rankid'])."\" size=\"3\">",true);                if ($row['gildenactive']=='1') output("<tr><td><label for=\"gildenactive\">Aktiv: </label><input type=\"radio\" name=\"gildenactive\" id=\"gildenactive\" value=\"0\">Nein<input type=\"radio\" name=\"gildenactive\" id=\"gildenactive\" value=\"1\" checked=\"checked\">Ja</td></tr>",true);                else output("<tr><td><label for=\"gildenactive\">Aktiv: </label>  Nein<input type=\"radio\" name=\"gildenactive\" id=\"gildenactive\" value=\"0\" checked=\"checked\"> Ja<input type=\"radio\" name=\"gildenactive\" id=\"gildenactive\" value=\"1\"></td></tr>",true);                output("<tr><td>`b<input type=\"submit\" value=\"Speichern\">`b</td></tr>",true);                output("</form></table>",true);                addnav("","gildentool.php?op=members&act=save");                addnav("Zurück zur Liste","gildentool.php?op=members&id=$row[memberid]");                break;            case 'save'://                output("`4 $_POST[acctid], $_POST[isleader], $_POST[rankid], $_POST[gildenactive], $_POST[memberid]`n`n");                $sql="UPDATE `accounts` SET `isleader`='$_POST[isleader]', `gildenactive`='$_POST[gildenactive]', rankid='$_POST[rankid]' WHERE `acctid`='$_POST[acctid]'";//                rawoutput($sql);                db_query($sql);                addnav("Zurück zur Liste der Mitglieder","gildentool.php?op=members&id=$_POST[memberid]");                break;            case 'delete':                $sql="UPDATE `accounts` SET `isleader`='0', `gildenactive`='0', memberid='0', rankid='0' WHERE `acctid`='".$_GET['acctid']."'";//                rawoutput($sql);                db_query($sql);                addnav("Zurück zur Liste der Mitglieder","gildentool.php?op=members&id=$_GET[memberid]");                break;        }        break;  case "drop":    dropguild_su($_GET['id']);    break;  case "activate":    activateguild($_GET['id'],$_GET['active']);    showguilds_su("gildentool.php?");    break;  endswitch;/* Navigation */addnav("Gildeneditor");addnav("Gilde erstellen",check_op("create","gildentool.php?op=create"));addnav("Alle Gilden anzeigen",check_op("showall","gildentool.php?op=showall"));addnav("Bewerbungen",check_op("bewerber","gildentool.php?op=bewerber"));addnav("Aktualisieren","gildentool.php");addnav("Zurück");addnav("Z?Zurück zur Grotte","superuser.php");addnav("W?Zurück zum Weltlichen","village.php");if(isset($session['user']['wo'])) $session['user']['wo'] = "Verschollen";page_footer();?>

