
<?phprequire_once "common.php";require_once "func/isnewday.php";require_once "func/titles.php";isnewday(3);page_header("RP-Chars ohne Titel reparieren");addnav("G?Zurück zur Grotte","superuser.php");addnav("W?Zurück zum Weltlichen","village.php");addnav("Titel reparieren","rptitle_repair.php?op=rebuild");if ($_GET['op']=="rebuild"){    $sql="SELECT acctid, login, name, title, ctitle, rp_only FROM `accounts` where rp_only<>'0' AND ctitle=''";    $result=db_query($sql);    $anzahl=db_num_rows($result);    $i=0;    $newname='';    while($row=db_fetch_assoc($result)){        if(strpos($row['name'],$row['title'])!==FALSE){            $newname=str_replace($row['title'].' ','',$row['name']);            output($newname.'`n');                $sql2="UPDATE accounts SET name='".$newname."' WHERE acctid=".$row['acctid']."";                db_query($sql2);            $i++;        }    }    $sql3="SELECT acctid, login, name, title, ctitle, rp_only FROM `accounts` where rp_only<>'0' AND title!=''";    $result3=db_query($sql3);    $anzahl2=db_num_rows($result3);    $j=0;    while($row=db_fetch_assoc($result3)){        $sql4="UPDATE accounts SET title='' WHERE acctid=".$row['acctid']."";        db_query($sql4);        $j++;    }    output($anzahl.' RPler ohne Titel insgesamt. Bei '.$i.' wurden die Displaynamen korrigiert!`n'.$anzahl2.' RPler mit Systemtitel insgesamt. Bei '.$j.' wurden die Systemtitel entfernt!');}page_footer();

