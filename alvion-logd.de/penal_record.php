
<?php /**  * Project: Penal record hack for Legend of the Green Dragon  *  * PHP Version 4 and 5  *  * Copyright (C) 2006 Thibaud Roth  *  * This program is free software; you can redistribute it and/or  * modify it under the terms of the GNU General Public License  * as published by the Free Software Foundation; either version 2  * of the License, or (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA  *  * @category   Browsergame  * @package    Legend of the Green Dragon  * @author     Thibaud Roth <thibaud.roth@betriebsdirektor.de>  * @copyright  2006 Thibaud Roth  * @license    http://www.fsf.org/licensing/licenses/gpl.txt GNU GPL Version 2  * @version    1.2; 04102006  * @link       http://thibaudroth.magicforrest.de/?lotgd/penal_record, http://www.kerhoat.de  */require_once "common.php";require_once "func/systemmail.php";require_once "func/isnewday.php";isnewday(1);$penal_record_type = array(1=>"Verwarnung wegen Spam an öffentlichen Plätzen"            , 2=>"Verwarnung wegen Nichteinhalten der RP-Regeln"            , 3=>"Verwarnung wegen unpassendem Namen"            , 4=>"Verwarnung wegen Beleidigungen"            , 5=>"Verwarnung wegen Werbung für andere Server in übertriebenem Masse"            , 6=>"Verwarnung wegen Nichtbeachtung der Anweisungen eines Admins"            , 7=>"Verwarnung wegen Sonstigem"            , 8=>"Verwarnung wegen nicht genehmigtem Multiaccount");page_header("Strafregister");addnav("G?Zurück zur Grotte","superuser.php");addnav("W?Zurück zum Weltlichen","village.php");//output("`^Bitte daran denken dem Verwarnten eine YoM zu schicken, geht `$ noch `^nicht automatisch raus, sorry ... kommt aber bald ^^`n`n`0");switch($_GET["op"]){  case "":    output("`bBisher verwarnte Spieler:`b<dl>",true);    $name = "0";    $query = mysql_query("SELECT penal_record.id,penal_record.timestamp, penal_record.type, penal_record.remark, accounts.name, accounts.penal_count FROM penal_record LEFT JOIN accounts USING(acctid) ORDER BY accounts.login");    while($row=db_fetch_assoc($query)){      if($name != $row["name"]){        output("</ul></dd>",true);        output("<dt>`b".$row["name"]."`b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; insgesamt:&nbsp; `4".$row["penal_count"]."`0</dt>",true);        $name = $row["name"];        output("<dd><ul><li>".$row["timestamp"].": ".$penal_record_type["".$row["type"].""]."",true);        if($row["remark"]!="") output("(Bemerkung: ".$row["remark"].")");        output(" [<a href=\"penal_record.php?op=delete&id=".$row["id"]."\">Löschen</a>]",true);        addnav("","penal_record.php?op=delete&id=".$row["id"]);        output("</li>",true);        }      else{        output("<li>".$row["timestamp"].": ".$penal_record_type["".$row["type"].""]."",true);        if($row["remark"]!="") output("(Bemerkung: ".$row["remark"].")");        output(" [<a href=\"penal_record.php?op=delete&id=".$row["id"]."\">Löschen</a>]",true);        addnav("","penal_record.php?op=delete&id=".$row["id"]);        output("</li>",true);        }      }    output("</ul></dd></dl>",true);    addnav("Eintrag hinzufügen","penal_record.php?op=search");    break;  case "search":    output("<form action=\"penal_record.php?op=add\" method=\"post\"><label for=\"name\">Charakter:</label> <input type=\"text\" name=\"name\" id=\"name\"><input type=\"submit\" value=\"Suchen\"></form>",true);    addnav("","penal_record.php?op=add");    break;  case "add":    $query = mysql_query("SELECT acctid,name,penal_count FROM accounts WHERE login LIKE '".addslashes($_POST["name"])."'");    if (db_num_rows($query)<=0){      output("Es wurde kein Charakter mit diesem Namen gefunden.");      addnav("Zurück zum Strafregister","penal_record.php");      }    while($row = db_fetch_assoc($query)){      output("`b".$row["name"].":`b",true);      output("<form action=\"penal_record.php?op=insert\" method=\"post\">",true);      output("<input type=\"hidden\" name=\"acctid\" value=\"".$row["acctid"]."\">",true);      output("<label for=\"type\">Art des Eintrags:</label> <select name=\"type\" id=\"type\"><option value=\"1\">".$penal_record_type["1"]."</option> <option value=\"2\">".$penal_record_type["2"]."</option> <option value=\"3\">".$penal_record_type["3"]."</option> <option value=\"4\">".$penal_record_type["4"]."</option> <option value=\"5\">".$penal_record_type["5"]."</option> <option value=\"6\">".$penal_record_type["6"]."</option> <option value=\"7\">".$penal_record_type["7"]."</option><option value=\"8\">".$penal_record_type["8"]."</option></select>",true);      output("<label for=\"remark\">Bemerkung:</label> <input type=\"text\" name=\"remark\" id=\"remark\"> (optionaler Kommentar)`n`n",true);      output("<input type=\"submit\" value=\"Eintragen\">",true);      output("</form>",true);      }      output("`n`n`7Farbcodes:`n");      $result = db_query("SELECT allowed, code FROM appoencode WHERE allowed='1'");    while ($row = db_fetch_assoc($result))    {          output("`$row[code]&#0096;$row[code]`0",true);    }    addnav("","penal_record.php?op=insert");    break;  case "insert":        mysql_query("INSERT INTO penal_record (acctid, timestamp, type, remark, insertedby) VALUES ('".$_POST["acctid"]."', NOW(), '".$_POST["type"]."', '".$_POST["remark"]."', '".$session[user][acctid]."')");    $sql="SELECT penal_count FROM accounts WHERE acctid=".$_POST['acctid'];    $query=db_query($sql);    $row2=db_fetch_assoc($query);    $row2['penal_count']+=1;    $sql="UPDATE accounts SET penal_count=".$row2['penal_count']." WHERE acctid=".$_POST['acctid'];    db_query($sql);//    output("`% sql=".$sql."`n");    if($_POST["type"] == "1"){      $body = "Hallo,`n        ich bitte dich OOC (out of Charakter) an öffentlichen Plätzen zu unterlassen und nur noch rollenspielgerechtes zu schreiben.`n        Schaue bei Fragen zum Spiel in den FAQ nach und wenn deine Fragen nicht geklärt werden, schicke eine Hilfeanfrage ab, oder mache dich im Forum kundig.`n        Bei privaten Unterhaltungen von Spieler zu Spieler, verwende bitte die Ye Olde Mail-Funktion oder begebe dich in das Offtopic.`n        Bei weiteren Vergehen, sehen wir uns gezwungen Maßnahmen zu ergreifen. Diese gehen von einer Geldstrafe, über eine Anprangerung bis hin zur Löschung des Accounts und Verbannung vom Server.`n        MfG`nDie Spielleitung";      systemmail($_POST['acctid'],"Verwarnung wegen Spam",$body,$session['user']['acctid']);      }    elseif($_POST["type"] == "2")    {        $body = "Sei gegrüsst!`n        Du hast auf einem der Plätze die RP-Regeln nicht eingehalten, deswegen bekommst du nun diese Mail!`n        Wir möchten dich bitten in Zukunft keine Smileys, Sternchenzeichen oder neumodernen Wörter mehr zu benutzen!`n        Bitte lese dir ausserdem , die beiden Bücher in der Bibliothek unter  Anleitungen und Hilfe durch, um weitere Fehler zu vermeiden!`n        Bei weiteren Regelverstössen, müssten wir dich Prangern! Falls du Hilfe brauchst kannst du dich jederzeit gerne an einen Admin wenden!`n        MfG`nDie Spielleitung!";      systemmail($_POST['acctid'],"Verwarnung wegen Nichteinhalten der RP-Regeln",$body,$session['user']['acctid']);    }    elseif($_POST["type"] == "3")    {        $body = "Sei gegrüsst!`n        Du hast einen unpassenden Namen! Deswegen wollen wir dich bitten, dir einen anderen Namen auszudenken und ihn umgehend bei uns zu melden!`n        Du hast eine Frist von 4 Tagen, solltest du dich bis dahin nicht gemeldet haben, sehen wir es vor, dich zu löschen!`n        MfG`nDie Spielleitung!";      systemmail($_POST['acctid'],"Verwarnung wegen unpassendem Namen",$body,$session['user']['acctid']);    }    elseif($_POST["type"] == "4")    {        $body = "Guten Tag!`n        Du hast auf den Plätzen jemanden Beleidigt und wirst deswegen nun von uns verwarnt!`n        Wir möchten dich bitten, soetwas in Zukunft zu unterlassen.`n        Solltest du dich dennoch nicht daran halten, musst du mit Prangerung bis hin zum Ausschluss vom Server rechnen!`n        MfG`nDie Spielleitung!";      systemmail($_POST['acctid'],"Verwarnung wegen Beleidigung",$body,$session['user']['acctid']);    }    elseif($_POST["type"] == "5")    {        $body = " Hallo!`n        Du hast in übertriebenem Maße, Werbung für einen anderen Server gemacht! Dieses wird hier nicht gern gesehen und du erhälst deshalb von uns diese Verwarnung.`n    Wir möchten dich bitten, soetwas in Zukunft zu unterlassen. Ansonsten drohen dir Prangerungen bis hin zum Ausschluss vom Server!`n    MfG`nDie Spielleitung";      systemmail($_POST['acctid'],"Verwarnung wegen Werbung für andere Server",$body,$session['user']['acctid']);    }    elseif($_POST["type"] == "6")    {        $body = "Sei gegrüsst!`n        Du erhälst diese Verwarnung, da du dich den Anweisungen eines Admins wiedersetzt hast und dem nicht folge geleistet hast!`n        Solltest du dich in Zukunft nicht an die Anweisungen halten, drohen dir Prangerstrafen bis hin zum Ausschluss vom Server!`n        MfG`nDie Spielleitung";      systemmail($_POST['acctid'],"Verwarnung wegen Nichtbeachtung der Anweisungen eines Admins",$body,$session['user']['acctid']);    }    elseif($_POST["type"] == "7")    {     // output("Es wurde keine Ye Olde Mail abgeschickt. Wenn nötig muss diese noch manuell verschickt werden.`n");     $body = "Hallo,`n    Du hast dich nicht an die Regeln auf diesem Server gehalten! Bitte halte dich in Zukunft daran, ansonsten drohen dir Konsequenzen!`n        MfG`nDie Spielleitung";      systemmail($_POST['acctid'],"Verwarnung wegen Sonstigem",$body,$session['user']['acctid']);    }    elseif($_POST["type"] == "8")    {            $body = "Hallo!`n            Du erhälst diese Verwarnung, da du mit mehreren Charakteren unterwegs bist (nicht genehmigter Multiaccount)!`n            Setze dich mit einem Admin (Gründer) in Verbindung, sonst drohen dir Strafen bis hin zum Ausschluss vom Server!`n            MfG`nDie Spielleitung";        systemmail($_POST['acctid'],"Verwarnung wegen nicht genehmigtem Multiaccount",$body,$session['user']['acctid']);    }    output("Die Verwarnung wurde eingetragen.");    addnav("Strafregister","penal_record.php");    break;  case "delete":    output("Soll der Eintrag wirklich gelöscht werden?");    addnav("Ja, löschen","penal_record.php?op=delete2&id=".$_GET["id"]);    addnav("Nein, zurück","penal_record.php");    break;  case "delete2":    mysql_query("DELETE FROM penal_record WHERE `id` = ".$_GET["id"]);    output("Erfolgreich gelöscht");    addnav("Zurück","penal_record.php");    break;  }page_footer();?>

