
<?php// 10092004// created by Lonny Luberts for http://www.pqcomp.com/logd, built on idea from quest's giftshop with all new code.// this file needs customization before use and is designed to be added in many places if need be// as different gift shops.// search and replace (newgiftshop.php) with what you name the giftshop php file// search and replace (gift 1)-(your gift) with your gifts - make sure you use the space inbetween gift & 1 etc...// if you do an auto replace with your editor.// be sure to edit the return nav// please feel free to use and edit this file, any major upgrades or improvements should be// mailed to logd@pqcomp.com for consideration as a permenant inclusion// please do not remove the comments from this file.// Version: 03212004//// changes to fit ext (GER) and translation by anpera// added items with buffsrequire_once "common.php";require_once "func/systemmail.php";checkday();page_header("Geschenkeladen");output("`c`b`&Geschenkeladen`0`b`c`n`n");if ($_GET[op]=="" && $session[user][turns]>0){    output("`rDu betrittst den Geschenkeladen und siehst eine Menge einzigartiger Gegenstände.`n");    output("Ein".($session[user][sex]?" junger Mann":"e junge Frau")." steht hinter der Ladentheke und lächelt dich sanft an.`n");    output("Ein Schild an der Wand verspricht \"`iGeschenkverpackung und Lieferung frei.`i\"`n");    // changed the next line to make sense for your gift shop (specialty)    // output("`3This shop specializes in specialty, you see for sale...`n`n"); // only need one shop    addnav("Tulpe","newgiftshop.php?op=send&op2=gift1");    if ($session[user][gold] > 10) addnav("Rose - 10 Gold","newgiftshop.php?op=send&op2=gift2");    if ($session[user][gold] > 20) addnav("Strauß Rosen - 20 Gold","newgiftshop.php?op=send&op2=gift3");    if ($session[user][gold] > 40) addnav("Pralinen - 40 Gold","newgiftshop.php?op=send&op2=gift4");    if ($session[user][gold] > 60) addnav("Freundschaftsbändchen - 60 Gold","newgiftshop.php?op=send&op2=gift5");    if ($session[user][gold] > 100) addnav("Freundschaftsanhänger - 100 Gold","newgiftshop.php?op=send&op2=gift6");    if ($session[user][gold] > 200) addnav("Halskette - 200 Gold","newgiftshop.php?op=send&op2=gift7");    if ($session[user][gold] > 500) addnav("Plüschdrachen - 500 Gold","newgiftshop.php?op=send&op2=gift8");    if ($session[user][gold] > 1000) addnav("Beutel Heilkräuter - 1000 Gold","newgiftshop.php?op=send&op2=gift9");    if ($session[user][gold] > 1500) addnav("Drachenei - 1500 Gold","newgiftshop.php?op=send&op2=gift10");    if ($session[user][gold] > 2000) addnav("Goldenes Amulett - 2000 Gold","newgiftshop.php?op=send&op2=gift11");    if ($session[user][gold] > 3000) addnav("Seltsamer Schädel - 3000 Gold","newgiftshop.php?op=send&op2=gift12");    output("`n<ul><a href=\"newgiftshop.php?op=send&op2=gift1\">Tulpe</a><br>",true);    addnav("","newgiftshop.php?op=send&op2=gift1");    if ($session[user][gold] > 10){        output("<a href=\"newgiftshop.php?op=send&op2=gift2\">Rose - 10 Gold</a><br>",true);        addnav("","newgiftshop.php?op=send&op2=gift2");    }    if ($session[user][gold] > 20){        output("<a href=\"newgiftshop.php?op=send&op2=gift3\">Strauß Rosen - 20 Gold</a><br>",true);        addnav("","newgiftshop.php?op=send&op2=gift3");    }    if ($session[user][gold] > 40){        output("<a href=\"newgiftshop.php?op=send&op2=gift4\">Pralinen - 40 Gold</a><br>",true);        addnav("","newgiftshop.php?op=send&op2=gift4");    }    if ($session[user][gold] > 60){        output("<a href=\"newgiftshop.php?op=send&op2=gift5\">Freundschaftsbändchen - 60 Gold</a><br>",true);        addnav("","newgiftshop.php?op=send&op2=gift5");    }    if ($session[user][gold] > 100){        output("<a href=\"newgiftshop.php?op=send&op2=gift6\">Freundschaftsanhänger - 100 Gold</a><br>",true);        addnav("","newgiftshop.php?op=send&op2=gift6");    }    if ($session[user][gold] > 200){        output("<a href=\"newgiftshop.php?op=send&op2=gift7\">Halskette - 200 Gold</a><br>",true);        addnav("","newgiftshop.php?op=send&op2=gift7");    }    if ($session[user][gold] > 500){        output("<a href=\"newgiftshop.php?op=send&op2=gift8\">Plüschdrachen - 500 Gold</a><br>",true);        addnav("","newgiftshop.php?op=send&op2=gift8");    }    if ($session[user][gold] > 1000){        output("<a href=\"newgiftshop.php?op=send&op2=gift9\">Beutel Heilkräuter - 1000 Gold</a><br>",true);        addnav("","newgiftshop.php?op=send&op2=gift9");    }    if ($session[user][gold] > 1500){        output("<a href=\"newgiftshop.php?op=send&op2=gift10\">Drachenei - 1500 Gold</a><br>",true);        addnav("","newgiftshop.php?op=send&op2=gift10");    }    if ($session[user][gold] > 2000){        output("<a href=\"newgiftshop.php?op=send&op2=gift11\">Goldenes Amulett - 2000 Gold</a><br>",true);        addnav("","newgiftshop.php?op=send&op2=gift11");    }    if ($session[user][gold] > 3000){        output("<a href=\"newgiftshop.php?op=send&op2=gift12\">Seltsamer Schädel - 3000 Gold</a><br>",true);        addnav("","newgiftshop.php?op=send&op2=gift12");    }    // Osteraddon von Linus    if ($datum >= '03-21' && $datum <= '03-24' || $session['user']['superuser']>=2){        output("`n");        if ($session[user][gold] >= 10){            addnav("`9O`2s`@t`^e`qr`\$ei`0 - 10 Gold","newgiftshop.php?op=send&op2=gift13");            output("<a href=\"newgiftshop.php?op=send&op2=gift13\">`9O`2s`@t`^e`qr`\$ei`0 - 10 Gold</a><br>",true);            addnav("","newgiftshop.php?op=send&op2=gift13");        }        if ($session[user][gold] >= 20){            addnav("`TS`Bc`Th`Bo`Tk`Bo`Cei`0 - 20 Gold","newgiftshop.php?op=send&op2=gift14");            output("<a href=\"newgiftshop.php?op=send&op2=gift14\">`TS`Bc`Th`Bo`Tk`Bo`Cei`0 - 20 Gold</a><br>",true);            addnav("","newgiftshop.php?op=send&op2=gift14");        }        if ($session[user][gold] >= 25){            addnav("`hN`Bo`hu`Bg`ha`Bt`Cei`0 - 25 Gold","newgiftshop.php?op=send&op2=gift15");            output("<a href=\"newgiftshop.php?op=send&op2=gift15\">`hN`Bo`hu`Bg`ha`Bt`Cei`0 - 25 Gold</a><br>",true);            addnav("","newgiftshop.php?op=send&op2=gift15");            addnav("`ìK`+r`Bo`ìc`+k`Ba`ìn`+t`Cei`0 - 25 Gold","newgiftshop.php?op=send&op2=gift16");            output("<a href=\"newgiftshop.php?op=send&op2=gift16\">`ìK`+r`Bo`ìc`+k`Ba`ìn`+t`Cei`0 - 25 Gold</a><br>",true);            addnav("","newgiftshop.php?op=send&op2=gift16");        }        if ($session[user][gold] >= 50){            addnav("`òK`4i`&r`=s`+c`òh`\$w`&a`=s`+s`òe`4r`4e`òi`0 - 50 Gold","newgiftshop.php?op=send&op2=gift17");            output("<a href=\"newgiftshop.php?op=send&op2=gift17\">`òK`4i`&r`=s`+c`òh`\$w`&a`=s`+s`òe`4r`4e`òi`0 - 50 Gold</a><br>",true);            addnav("","newgiftshop.php?op=send&op2=gift17");            addnav("`tE`^i`ìe`^rl`ìik`^ör`ìei`0 - 50 Gold","newgiftshop.php?op=send&op2=gift18");            output("<a href=\"newgiftshop.php?op=send&op2=gift18\">`tE`^i`ìe`^rl`ìik`^ör`ìei`0 - 50 Gold</a><br>",true);            addnav("","newgiftshop.php?op=send&op2=gift18");        }        if ($session[user][gold] >= 500){            addnav("`TO`Bs`Ct`te`8r`Ch`Ba`Tse`0 - 500 Gold","newgiftshop.php?op=send&op2=gift19");            output("<a href=\"newgiftshop.php?op=send&op2=gift19\">`TO`Bs`Ct`te`8r`Ch`Ba`Tse`0 - 500 Gold</a><br>",true);            addnav("","newgiftshop.php?op=send&op2=gift19");            addnav("`8O`es`Gte`gr`&l`=ä`hm`Cm`Bc`Ch`he`&n`0 - 500 Gold","newgiftshop.php?op=send&op2=gift20");            output("<a href=\"newgiftshop.php?op=send&op2=gift20\">`8O`es`Gte`gr`&l`=ä`hm`Cm`Bc`Ch`he`&n`0 - 500 Gold</a><br>",true);            addnav("","newgiftshop.php?op=send&op2=gift20");            addnav("`GO`es`Ot`ìer`^kü`wck`ìen`0 - 500 Gold","newgiftshop.php?op=send&op2=gift21");            output("<a href=\"newgiftshop.php?op=send&op2=gift21\">`GO`es`Ot`ìer`^kü`wck`ìen`0 - 500 Gold</a><br>",true);            addnav("","newgiftshop.php?op=send&op2=gift21");        }        if ($session[user][gold] >= 5000){            addnav("`gÜ`%b`íe`Jr`9r`Ja`ís`Jc`gh`%u`9n`Jg`ís`ge`Ji`0 - 5000 Gold","newgiftshop.php?op=send&op2=gift22");            output("<a href=\"newgiftshop.php?op=send&op2=gift22\">`gÜ`%b`íe`Jr`9r`Ja`ís`Jc`gh`%u`9n`Jg`ís`ge`Ji`0 - 5000 Gold</a><br>",true);            addnav("","newgiftshop.php?op=send&op2=gift22");        }    }    // Ende Osteraddon von Linus    output("</ul>",true);    addnav("Sonstiges");    if (getsetting("activategamedate","0")>0){        $cakecost=$session['user']['level']*15;        addnav("Torte werfen ($cakecost Gold)","newgiftshop.php?op=cake");    }    // change this nav to return to the location you call it from    addnav("Zurück zum Marktplatz","marktplatz.php");}else if ($session[user][turns]<=0){    output("`rDer Geschenkeladen hat jetzt leider schon geschlossen.");    addnav("P?Zurück zum Marktplatz","marktplatz.php");}if ($_GET[op]=="send"){    $gift=$_GET[op2];    if (isset($_POST['search']) || $_GET['search']>""){        if ($_GET['search']>"") $_POST['search']=$_GET['search'];        $search="%";        for ($x=0;$x<strlen($_POST['search']);$x++){            $search .= substr($_POST['search'],$x,1)."%";        }        $search="name LIKE '".$search."' AND ";        if ($_POST['search']=="weiblich") $search="sex=1 AND ";        if ($_POST['search']=="männlich") $search="sex=0 AND ";    }else{        $search="";    }    $ppp=25; // Player Per Page to display    if (!$_GET[limit]){        $page=0;    }else{        $page=(int)$_GET[limit];        addnav("Vorherige Seite","newgiftshop.php?op=send&op2=$gift&limit=".($page-1)."&search=$_POST[search]");    }    $limit="".($page*$ppp).",".($ppp+1);    $sql = "SELECT login,name,level,sex,acctid FROM accounts WHERE $search locked=0 AND acctid<>".$session[user][acctid]." AND lastip<>'".$session[user][lastip]."' AND charm>1 ORDER BY login,level LIMIT $limit";    $result = db_query($sql);    if (db_num_rows($result)>$ppp) addnav("Nächste Seite","newgiftshop.php?op=send&op2=$gift&limit=".($page+1)."&search=$_POST[search]");    output("`rWem willst du das Geschenk schicken?`n`n");    output("<form action='newgiftshop.php?op=send&op2=$gift' method='POST'>Nach Name suchen: <input name='search' value='$_POST[search]'><input type='submit' class='button' value='Suchen'></form>",true);    addnav("","newgiftshop.php?op=send&op2=$gift");    output("<table cellpadding='3' cellspacing='0' border='0'><tr class='trhead'><td>Name</td><td>Level</td><td>Geschlecht</td></tr>",true);    for ($i=0;$i<db_num_rows($result);$i++){        $row = db_fetch_assoc($result);        output("<tr class='".($i%2?"trlight":"trdark")."'><td><a href='newgiftshop.php?op=send2&op2=$gift&name=".HTMLEntities($row['acctid'])."'>",true);        output($row['name']);        output("</a></td><td>",true);        output($row['level']);        output("</td><td align='center'><img src='images/".($row['sex']?"female":"male").".gif'></td></tr>",true);        addnav("","newgiftshop.php?op=send2&op2=$gift&name=".HTMLEntities($row['acctid']));    }    output("</table>",true);    addnav("Zurück zum Laden","newgiftshop.php");}if ($_GET[op]=="send2"){    $name=$_GET[name];    $effekt="";    if ($_GET[op2]=="gift1"){        $gift="Tulpe";    }    if ($_GET[op2]=="gift2"){        $gift="Rose";        $session[user][gold]-=10;    }    if ($_GET[op2]=="gift3"){        $gift="Strauß Rosen";        $session[user][gold]-=20;    }    if ($_GET[op2]=="gift4"){        $gift="Pralinen";        $effekt="Natürlich futterst du sie sofort alle auf.";        $session[user][gold]-=40;    }    if ($_GET[op2]=="gift5"){        $gift="Freundschaftsbändchen";        db_query("INSERT INTO items (name,owner,class,gold,description) VALUES ('Freundschaftsbändchen',$name,'Geschenk',12,'Ein Freundschaftsbändchen von ".$session[user][name]."')");        $session[user][gold]-=60;    }    if ($_GET[op2]=="gift6"){        $gift="Freundschaftsanhänger";        db_query("INSERT INTO items (name,owner,class,gold,description) VALUES ('Freundschaftsanhänger',$name,'Geschenk',20,'Ein Freundschaftsänhänger von ".$session[user][name]."')");        $session[user][gold]-=100;    }    if ($_GET[op2]=="gift7"){        $gift="Halskette";        db_query("INSERT INTO items (name,owner,class,gold,description) VALUES ('Halskette',$name,'Geschenk',40,'Diese Halskette hat dir ".$session[user][name]." geschenkt.')");        $session[user][gold]-=200;    }    if ($_GET[op2]=="gift8"){        $gift="Plüschdrachen";        $effekt="`RDer ist ja soooooo süüüüüüüüüüüssss!!!`0";        db_query("INSERT INTO items (name,owner,class,gold,description) VALUES ('Plüschdrachen',$name,'Geschenk',100,'`REin `@Grüner Drachen`R aus Plüsch zum Kuscheln. Der ist von ".$session[user][name].".')");        $session[user][gold]-=500;    }    if ($_GET[op2]=="gift9"){        $gift="Beutel Heilkräuter";        $buff = array("name"=>"`1Heilkräuter","rounds"=>20,"wearoff"=>"`1Die Heilkräuter verlieren ihre Wirkung!`0","regen"=>1.2,"roundmsg"=>"`1Die Heilkräuter heilen deine Wunden.`0","activate"=>"defense");        $buff=serialize($buff);        $effekt="Diese Heilkräuter heilen Wunden, bleiben aber nicht lange frisch.";        db_query("INSERT INTO items (name,owner,class,gold,description,hvalue,buff) VALUES ('Beutel Heilkräuter',$name,'Geschenk',500,'$effekt',1,'$buff')");        $session[user][gold]-=1000;    }    if ($_GET[op2]=="gift10"){        $gift="Drachenei";        $session[user][gold]-=1500;    }    if ($_GET[op2]=="gift11"){        $gift="Goldenes Amulett";        $buff = array("name"=>"`rAmulettaura`0","rounds"=>10,"wearoff"=>"`rDie Aura des Amuletts verschwindet.`0","defmod"=>1.1,"activate"=>"roundstart");        $buff=serialize($buff);        $effekt="Als du das Amulett anlegst, hüllt es dich in eine merkwürdige, schützende Aura. Der Beipackzettel verrät dir, dass das Amulett nach 3 Tagen seine Wirkung verliert und zu Staub zerfallen wird.";        db_query("INSERT INTO items (name,owner,class,gold,description,hvalue,buff) VALUES ('Goldenes Amulett',$name,'Geschenk',1000,'$effekt',3,'$buff')");        $session[user][gold]-=2000;    }    if ($_GET[op2]=="gift12"){        $gift="Seltsamer Schädel";        $gefallen=e_rand(5,10);        $effekt="Du untersuchst dieses merkwürdige Geschenk genauer. Dabei rutscht es dir aus der Hand und zerplatzt am Boden in 1000 Stücke. Doch eine seltsame Kraft wird frei, die dir $gefallen Gefallen bei Ramius bringt!";        db_query("UPDATE accounts SET deathpower=deathpower+$gefallen WHERE acctid=$name");        $session[user][gold]-=3000;    } else { // Osteraddon von Linus        switch($_GET['op2']) {            case "gift13":                $gift="`9O`2s`@t`^e`qr`\$ei`0";                $effekt="Natürlich futterst du es sofort auf.";                $session['user']['gold']-=10;            break;            case "gift14":                $gift="`TS`Bc`Th`Bo`Tk`Bo`Cei`0";                if(mt_rand(1,10)%3==0){                    $effekt="Natürlich futterst du es sofort auf. Doch du beißt auf etwas hartes. Du hast 100 Goldstücke in deinem Ei gefunden.";                    db_query("UPDATE `accounts` SET `gold`=`gold`+100 WHERE `acctid`='$name'");                } else {                    $effekt="Natürlich futterst du es sofort auf.";                }                $session['user']['gold']-=20;            break;            case "gift15":                $gift="`hN`Bo`hu`Bg`ha`Bt`Cei`0";                if(mt_rand(1,10)%4==0){                    $effekt="Natürlich futterst du es sofort auf. Doch du beißt auf etwas hartes. Du hast 500 Goldstücke in deinem Ei gefunden.";                    db_query("UPDATE `accounts` SET `gold`=`gold`+500 WHERE `acctid`='$name'");                } else {                    $effekt="Natürlich futterst du es sofort auf.";                }                $session['user']['gold']-=25;            break;            case "gift16":                $gift="`ìK`+r`Bo`ìc`+k`Ba`ìn`+t`Cei`0";                if(mt_rand(1,10)%4==0){                    $effekt="Natürlich futterst du es sofort auf. Doch du beißt auf etwas hartes. Du hast 500 Goldstücke in deinem Ei gefunden.";                    db_query("UPDATE `accounts` SET `gold`=`gold`+500 WHERE `acctid`='$name'");                } else {                    $effekt="Natürlich futterst du es sofort auf.";                }                $session['user']['gold']-=25;            break;            case "gift17":                $gift="`òK`4i`&r`=s`+c`òh`\$w`&a`=s`+s`òe`4r`4e`òi`0";                if(mt_rand(1,10)%7==0){                    $effekt="Natürlich futterst du es sofort auf. Doch du beißt auf etwas hartes. Du hast einen Edelstein in deinem Ei gefunden.";                    db_query("UPDATE `accounts` SET `gems`=`gems`+1 WHERE `acctid`='$name'");                } else {                    $effekt="Natürlich futterst du es sofort auf.";                }                $session['user']['gold']-=50;            break;            case "gift18":                $gift="`tE`^i`ìe`^rl`ìik`^ör`ìei`0";                if(mt_rand(1,10)%7==0){                    $effekt="Natürlich futterst du es sofort auf. Doch du beißt auf etwas hartes. Du hast einen Edelstein in deinem Ei gefunden.";                    db_query("UPDATE `accounts` SET `gems`=`gems`+1 WHERE `acctid`='$name'");                } else {                    $effekt="Natürlich futterst du es sofort auf.";                }                $session['user']['gold']-=50;            break;            case "gift19":                $gift="`TO`Bs`Ct`te`8r`Ch`Ba`Tse`0";                $effekt="`RDer ist ja soooooo süüüüüüüüüüüssss!!!`0";                db_query("INSERT INTO items (name,owner,class,gold,description) VALUES ('`TO`Bs`Ct`te`8r`Ch`Ba`Tse`0',$name,'Geschenk',100,'`REin `TO`Bs`Ct`te`8r`Ch`Ba`Tse`R aus Plüsch zum Knuddeln. Ein Geschenk von ".$session[user][name].".')");                $session[user][gold]-=500;            break;            case "gift20":                $gift="`8O`es`Gte`gr`&l`=ä`hm`Cm`Bc`Ch`he`&n`0";                $effekt="`RDas ist ja soooooo süüüüüüüüüüüssss!!!`0";                db_query("INSERT INTO items (name,owner,class,gold,description) VALUES ('`8O`es`Gte`gr`&l`=ä`hm`Cm`Bc`Ch`he`&n`0',$name,'Geschenk',100,'`REin `8O`es`Gte`gr`&l`=ä`hm`Cm`Bc`Ch`he`&n`R aus Plüsch zum Knuddeln. Ein Geschenk von ".$session[user][name].".')");                $session[user][gold]-=500;            break;            case "gift21":                $gift="`GO`es`Ot`ìer`^kü`wck`ìen`0";                $effekt="`RDas ist ja soooooo süüüüüüüüüüüssss!!!`0";                db_query("INSERT INTO items (name,owner,class,gold,description) VALUES ('`GO`es`Ot`ìer`^kü`wck`ìen`0',$name,'Geschenk',100,'`REin `GO`es`Ot`ìer`^kü`wck`ìen`R aus Plüsch zum lieb haben. Ein Geschenk von ".$session[user][name].".')");                $session[user][gold]-=500;            break;            case "gift22":                $gift="`gÜ`%b`íe`Jr`9r`Ja`ís`Jc`gh`%u`9n`Jg`ís`ge`Ji`0";                $effekt="Du teilst die Schokoladenhälften, gespannt darauf was du im inneren des `gÜ`%b`íe`Jr`9r`Ja`ís`Jc`gh`%u`9n`Jg`ís`ge`Ji`7 finden wirst. ";                $sw=mt_rand(1,100);                switch(TRUE){                    case ($sw<=30):                        $effekt.="Du hast fünf Edelsteine in deinem Ei gefunden.";                        db_query("UPDATE `accounts` SET `gems`=`gems`+5 WHERE `acctid`='$name'");                    break;                    case ($sw>30 AND $sw<=35):                        $effekt.="Ein Zettel fällt aus dem Ei, du hebst ihn auf und zu deiner Freude stellst du fest das es sich um einen Passierschein handelt.";                        db_query("INSERT INTO items (name,owner,class,gold,gems,description) VALUES ('Passierschein A38',$name,'Dokument',1000,3,'Endlich hältst du ihn in deinen Händen, doch wer weiss wozu er dient?')");                        db_query("UPDATE `accounts` SET `p38`=0 WHERE `acctid`='$name'");                    break;                    case ($sw>35 AND $sw<=70):                        $gold=mt_rand(4000,10000);                        $effekt.="Es ist der Beleg einer Banküberweisung. Deinem Konto wurden $gold Goldstücke gut geschrieben";                        db_query("UPDATE `accounts` SET `goldinbank`=`goldinbank`+$gold WHERE `acctid`='$name'");                    break;                    case ($sw>70):                        $effekt.="Es ist netter Brief von jemandem der dich lieb hat. Deine Lippen formen ein glückliches Lächeln und du erhälst 20 Charmepunkte";                        db_query("UPDATE `accounts` SET `charm`=`charm`+20 WHERE `acctid`='$name'");                    break;                }                $session['user']['gold']-=5000;            break;        }    } // Ende Osteraddon von Linus    $mailmessage=$session[user][name];    $mailmessage.="`7 hat dir ein Geschenk geschickt.  Du öffnest es. Es ist ein/e `6";    $mailmessage.=$gift;    //you can change the following the match what you name your gift shop    $mailmessage.="`7 aus dem Geschenkeladen.`n".$effekt;    systemmail($name,"`2Geschenk erhalten!`2",$mailmessage);    output("`rDein $gift `rwurde als Geschenk verschickt!");    if (e_rand(1,3)==2){        output(" Bei der Wahl des Geschenks und dem liebevollen Verpacken vergisst du die Zeit und vertrödelst einen Waldkampf.");        $session[user][turns]--;    }    addnav("Weiter","newgiftshop.php");}if ($_GET['op']=="cake"){ // this part was done for claymore's birthday :)    if (!isset($_POST['throw'])){        $wer=getsetting("cakevip","");        $geb = explode('-',getsetting('gamedate','0000-01-01'));        $find = array('%Y','%y','%m','%n','%d','%j');        $replace = array('','',sprintf('%02d',$geb[1]),(int)$geb[1],sprintf('%02d',$geb[2]),(int)$geb[2]);        $geb = str_replace($find,$replace,getsetting('gamedateformat','%Y-%m-%d'));        $result=db_query("SELECT login,name FROM accounts WHERE locked=0 AND birthday LIKE '%$geb%' AND acctid<>".$session[user][acctid]." ORDER BY login ASC");        if ($wer=="" && db_num_rows($result)<=0){            output("`r".($session[user][sex]?"Der Mann":"Die Frau")." hinter dem Ladentisch schaut dich verwirrt an, denn heute, $geb, ist für niemanden ein besonderer Tag. Das Bewerfen mit Torten könnte an Tagen, an denen das Ziel nicht Geburtstag hat, von diesem als Angriff gewertet werden. ");            output("Darum sollte man auf diesen Brauch an normalen Tagen besser verzichten.`nEnttäuscht wendest du dich ab.");            addnav("Zurück zum Marktplatz","marktplatz.php");        }else{            output("`r".($session[user][sex]?"Der Mann":"Die Frau")." hinter dem Ladentisch setzt ein breites Grinsen auf und fragt dich, welches der Geburtstagskinder du gerne mit einer Torte beglücken möchtest, wie es hier Brauch ist.`n`n");            output("<form action='newgiftshop.php?op=cake' method='POST'>`rZielperson: <select name='throw'>",true);            if ($wer!="") output("<option value='".rawurlencode($wer)."'>$wer</option>",true);            for ($i=0;$i<db_num_rows($result);$i++){                $row = db_fetch_assoc($result);                output("<option value='".rawurlencode($row['login'])."'>".preg_replace("'[`].'","",$row['name'])."</option>",true);            }            output("</select>`n`n<input type='submit' class='button' value='Torte kaufen'></form>",true);            addnav("","newgiftshop.php?op=cake");        }    }else{        $result=db_query("SELECT acctid,name,sex FROM accounts WHERE login='$_POST[throw]' LIMIT 1");        if (db_num_rows($result)<=0){            output("`r $_POST[throw]s Geburtstag ist entweder schon vorbei, oder es gibt ihn gar nicht.`nEnttäuscht wendest du dich ab.");            addnav("Zurück zum Marktplatz","marktplatz.php");        }else if ($session[user][witch]>0){            output("`rDu kannst heute leider keine Torte mehr werfen.");            addnav("Zurück zum Marktplatz","marktplatz.php");        }else if ($session[user][gold]<$session[user][level]*15){            output("`rDu hast nicht genug Gold für diesen Spaß dabei.");            addnav("Zurück zum Marktplatz","marktplatz.php");        }else{            $row = db_fetch_assoc($result);            $result2=db_query("SELECT * FROM items WHERE class='Geschenk' AND owner=$row[acctid] AND name='Tortenreste'");            $torte=e_rand(1,7);            if (db_num_rows($result2)>0) $item = db_fetch_assoc($result2);            if (db_num_rows($result2)>0) $torte=$item[value2];            switch($torte){                case 1:                $wie="große und saftige";                break;                case 2:                $wie="ganz süße";                break;                case 3:                $wie="schokoladige";                break;                case 4:                $wie="besonders sahnige";                break;                case 5:                $wie="möglichst harte";                break;                case 6:                $wie="besonders kalorienreiche";                break;                case 7:                $wie="besonders klebrige";            }            $item[hvalue]++;            $buff = array("name"=>"`rTortenreste`0","rounds"=>15,"wearoff"=>"`REinige der Tortenreste fallen von dir ab.`0","roundmsg"=>"`RTortenreste bremsen die Angriffe deines Gegners.`0","defmod"=>1.1,"activate"=>"roundstart");            $buff=serialize($buff);            output("`rDu suchst dir eine $wie Torte für `&$row[name]`r aus. Damit bewaffnet machst du dich auf die Suche nach `&$row[name]`r und als du ".($row[sex]?"sie":"ihn")." gefunden hast...`n`n");            output("`&`b`c<font size='5'>*PLATSCH*</font>`b`c`r`n",true);            output("`r...wirfst du sie ".($row[sex]?"ihr":"ihm")." mitten ins Gesicht und brüllst ".($row[sex]?"ihr":"ihm")." ein fröhliches `b`RHAPPY BIRTHDAY`b`r entgegen.`n`n");            output("`&$row[name]`r wird an den Tortenresten sicher noch lange ".($row[sex]?"ihre":"seine")." Freude haben. ".($row[sex]?"Sie":"Er")." trägt damit die klebrigen Reste von $item[hvalue] Torten an sich herum." );            if (db_num_rows($result2)>0){                $sql="UPDATE items SET hvalue=$item[hvalue] WHERE class='Geschenk' AND owner=$row[acctid] AND name='Tortenreste'";            }else{                $sql="INSERT INTO items (name,owner,class,gold,description,value2,hvalue,buff) VALUES ('Tortenreste',$row[acctid],'Geschenk',0,'Tortenreste von $item[hvalue] Geburtstagstorten kleben an dir.',$torte,$item[hvalue],'$buff')";                systemmail($row[acctid],"`rAchtung! Torte!","`&`bPLATSCH!`b`r Zu spät.`nDu wurdest von deiner ersten Geburtstagstorte getroffen... weitere werden heute bestimmt noch folgen. Es ist eine $wie Sorte. (Die genaue Anzahl siehst du in deinem Inventar.)");            }            db_query($sql);            $session[user][reputation]+=2;            $session[user][witch]++;            $session[user][gold]-=(15*$session[user][level]);            addnav("Z?Zurück ins Dorf","village.php");        }    }    addnav("Zurück zum Laden","newgiftshop.php");}page_footer();?>

