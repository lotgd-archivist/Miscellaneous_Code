
<?php// Coded by Taikun. www.logd-midgar.de// angepasst für Alvion von Linus   http://www.die-waelder-von-alvion.de/logd/#Angepasst von Harthas für Alvion - `n oder nl2br?/*SQL:CREATE TABLE `bio` (    `acctid` int(11) NOT NULL default '0',    `bio` text NOT NULL,    `avatar` text NOT NULL,    `mountbio` text NOT NULL,    `mountavatar` text NOT NULL,    `tiername` varchar(50) NOT NULL,    `weaponname` varchar(50) NOT NULL,    `armorname` varchar(50) NOT NULL,    `biotime` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',  PRIMARY KEY  (`acctid`)) TYPE=MyISAM;--- Nun folgenden Befehl ausführen:INSERT INTO `bio` (`acctid`, `bio`, `avatar`, `mountbio`, `mountavatar`, `tiername`, `weaponname`, `armorname`, `biotime`)    SELECT `acctid`, `bio`, `avatar`, `mountbio`, `mountavatar`, `tiername`, `weaponname`, `armorname`, `biotime` FROM `accounts`*/require_once "common.php";require_once "func/showform.php";page_header("Biographien");addnav("Z?Zurück zu den Einstellungen","prefs.php");addnav("u?Zurück Ins Dorf","village.php");if($_GET['op']==""){    output("Bitte wähle die gewünschte Aktion aus!`n`n");    $editlink = 'biograph.php?op=1&id='.$session['user']['acctid'];     $biolink  = 'bio.php?char='.(rawurlencode($session['user']['login'])).'&ret='.urlencode($_SERVER['REQUEST_URI']);    addnav( "Bio editieren" , $editlink );    addnav( "Bio anschauen" , $biolink );    if ( $session['user']['superuser'] >= 1 ) {        addnav( 'Einstellungen' );        addnav( 'Einstellungen ändern' , 'biograph.php?op=settings' );    }    if( $session['user']['acctid'] == 2 ) addnav("Bio reparieren","biograph.php?op=3&id=$row1[acctid]");    $sql = 'SELECT `acctid` FROM `bio` WHERE `acctid` = '.$session['user']['acctid'].';';    $result = db_query( $sql ) or die( db_error( LINK ) );    $row = db_fetch_assoc( $result );    if ( empty( $row['acctid'] ) ) {        $sql = "INSERT INTO bio (acctid, login) VALUES ('".$session['user']['acctid']."','".$session['user']['login']."')";        db_query( $sql ) or die( db_error( LINK ) );    }}if ( $_GET['op'] == 'settings' ) {    $sql = 'SELECT `nl2br_enabled` FROM `bio` WHERE `acctid` = '.$session['user']['acctid'];    $result = db_query( $sql );    $biosettings = db_fetch_assoc( $result );    output( '`c`tÄndere deine Biografieeinstellungen`c`n`n' );    rawoutput("<form action='biograph.php?op=savesettings' method='POST'>");    $form = array();    $form['nl2br_enabled'] = "Willst du ``n oder die Entertaste für Absätze benutzen?,enum,0,`n,1,Entertaste";    showform( $form , $biosettings );    rawoutput( '</form>' );    allownav('biograph.php?op=savesettings' );}if ( $_GET['op'] == 'savesettings' ) {    $sql = 'UPDATE `bio` SET `nl2br_enabled` = '.$_POST['nl2br_enabled'].' WHERE `acctid` = '.$session['user']['acctid'].'';    db_query( $sql ) or die( db_error( LINK ) );    redirect( 'biograph.php' );}if($_GET['op']=="1"){    $res = db_query("SELECT * FROM `bio` WHERE `acctid`='".$_GET['id']."'");    $row = db_fetch_assoc($res);    output("<form action='biograph.php?op=2&id=$_GET[id]' method='POST'>", true);//    $maxbio = getsetting("maxbio", 255);    $form=array(        "bio"=>"Kurzbeschreibung des Charakters `n(Maximal {$maxbio} Zeichen),textarea,60,40,$maxbio",        "avatar"=>"Link auf einen Avatar`n(Bilddatei - maximal 400x400 Pixel)`n"        );    $config = unserialize($session['user']['donationconfig']);    if ( ($session['user']['hashorse'] > 0 || $session[user][rp_only] )&& $config['namechangetier']) {        $form['mountbio'] = "Beschreibung des Tieres`n,textarea,60,25";        $form['mountavatar'] = "Link auf einen Tieravatar`n(Bilddatei - maximal 400x400 Pixel)`n";    }    $prefs['bio']         = $row['bio'];    $prefs['avatar']      = $row['avatar'];    $prefs['mountbio']    = $row['mountbio'];    $prefs['mountavatar'] = $row['mountavatar'];    showform($form,$prefs);    rawoutput( '</form>' );    allownav("biograph.php?op=2&id=".$_GET[id]);    addnav("Biohilfe", "biohilfe.php",false,true);    addnav("Farbtabelle", "farben_popup.php",false,true);}if($_GET['op']=="2"){        $bio         = mysqli_real_escape_string($mysqli, stripslashes($_POST['bio']));        $avatar      = mysqli_real_escape_string($mysqli, stripslashes($_POST['avatar']));        $mountbio    = mysqli_real_escape_string($mysqli, stripslashes($_POST['mountbio']));        $mountavatar = mysqli_real_escape_string($mysqli, stripslashes($_POST['mountavatar']));        db_query("UPDATE bio SET avatar='$avatar', bio='$bio', mountbio='$mountbio', mountavatar='$mountavatar', `biotime` = '".date('Y-m-d H:i:s')."' WHERE acctid='".$_GET['id']."'");        redirect("biograph.php");}if($_GET['op']=="3"){    $res = db_query("SELECT * FROM `bio`");    while($row = db_fetch_assoc($res)){        $res2 = db_query("SELECT acctid, login FROM `accounts` WHERE `acctid`='".$row['acctid']."'");        $row2 = db_fetch_assoc($res2);        if($row['login']!=$row2['login']) db_query("UPDATE `bio` SET `login`='".$row2['login']."' WHERE `acctid`='".$row2['acctid']."'");    }}page_footer();

