
<?php/*+----------------------------------+| Diese Box bitte nicht entfernen! |+----------------------------------+| Idee & Texte: Dragoria           || http://www.logd.wyrmslayer.de    || Umsetzung: Draza´ar              || http://www.legend-of-vinestra.de || wasserfall.php v.0.9             |+----------------------------------+Einbau: - irgendwo verlinken^^ ( addnav("Wasserfall","wasserfall.php"); ) - SQL: ALTER TABLE `accounts` ADD `privatID` INT( 11 ) NOT NULL DEFAULT '0' ;*/require_once "common.php";require_once "func/systemmail.php";addcommentary();// $session[user][location]=45;$u = &$session['user'];page_header("Der Wasserfall");$session['user']['standort']="Wasserfall";output("`c`b`(D`,e`dr `DWasserf`da`,l`(l`b`n`n");output("<img src='./images/wasserfall.gif'>`n`n`c",true);//addnav("zurück zur grotte","superuser.php");switch($_GET['op']){        case '':    //Außen vor dem Wasserfall                output("`DEin`d wun`,der`(voller Anblick bi`,ete`dt si`Dch dir, als du n`dach`, eine`(m schier endl`,ose`dn Sp`Daziergang de`dn Was`,ser`(fall erreichst. A`,lle`ds li`Degt in einem mys`dtis`,ch bl`(äulichen Schimme`,r. Hi`der u`Dnd da erkennst d`du ei`,n Le`(uchten und ein G`,lit`dzer`Dn, welches von de`dn St`,ein`(en unterhalb der W`,ass`dero`Dberfläche ausgeht. Ei`dn lei`,ses `(aber gedämpftes Rausch`,en i`dst z`Du vernehmen. B`dei gen`,aue`(r Betrachtung kann m`,an e`drken`Dnen, dass sich hin`dter`, dem`( Wasserfall eine H`,öhl`de bef`Dindet, aus welcher h`dell`,es Li`(cht nach außen dr`,ing`dt. Zu `Dschön ist es anzuse`dhen`, wie`( sich das Licht i`,m Was`dser `Dspiegelt und für ein wah`dres `,Farb`(enmeer sorgt. Man kön`,nte `dbein`Dahe meinen, dass e`ds sch`,öne`(r ist als das Licht der S`,ter`dne u`Dnd prachtvoller als d`die F`,arb`(en des Regenbogens. `,Was`d sic`Dh wohl in die`dser`, Höh`(le verbirg`,t?`n`n");                //Navigation                addnav("Aktionen");                addnav("Höhle betreten","wasserfall.php?op=hoehle");                addnav("Dem Wasserverlauf folgen","nebelsee.php");                addnav("Umkehren");                addnav("Zurück zur Lichtung","lichtung.php");                //Textfeld                viewcommentary("wasserfall","Hinzufügen",25,"sagt",1,1);                output("`n`n`9Ein bunter Papagei fliegt vorbei und krächzt dir dabei zu, dass dies ein Ort für Rollenspiel ist. Bitte an die Rpg-Regeln halten.");        break;        case 'hoehle':      //Höhle betreten                output("`b`dD`Di`Ye `ÉH`Íö`Éh`Yl`De`d am Wa`Ds`Ys`Ée`Ír`Éf`Ya`Dl`dl`b`n`n`dFür `Dkur`Yze Z`Éei`Ít wirst du beim Eintret`Éen i`Yn di`De Hö`dhle geblendet. Auf den ers`Dten`Y Bli`Éck i`Íst es dir schleierha`Éft, w`Yo da`Ds Li`dcht her kommt. War es d`Das L`Yich`Ét de`Ír Sonne, die dir einen Str`Éeic`Yh sp`Dielt `doder war es gar Magie? Ers`Dt al`Ys si`Éch d`Íein`Ye Aug`Den l`dangsam an das sc`Dhwa`Yche `ÉLicht`Í gewöhnt haben, bemerkst d`Éu ei`Yn Gl`Ditz`dern, das von der Höhle`Dnwan`Yd au`Ésge`Íht.`n Hier und da funkelt ein Sma`Éragd`Y, ein`D Rub`din, ein Diamant... Die Gi`Der w`Yürd`Ée in `Ídir aufsteigen, wäre die`És ni`Ycht `Dein`d Anblick, der dir immer i`Dm Ge`Ydäch`Étni`Ís bleiben würde. Sofort setzt du deine`Én We`Yg for`Dt, bi`ds sich die Höhlenwände schließlic`Dh zu`Y ein`Éem r`Íiesigen Raum öffnen und eine unterirdis`Éche`Y Lan`Ddsc`dhaft preis geben, wie du sie dir nicht einmal i`Dm Tr`Yaum `Éhätt`Íest vorstellen können. Glitzer`Énd`Ye Ede`Dlste`dine säumen die Wände, kräftig gr`Düne`Ys Mo`Éos b`Íedeckt den Boden und unzählig`Ée Gl`Yühw`Dürm`dchen sorgen für ein ged`Dämp`Yfte`És Li`Ícht. So etwas hattest du in deine`Ém ga`Ynze`Dn Le`dben noch nicht gesehen. Sofort waren alle S`Dorg`Yen wi`Ée ve`Írflogen. `n`n");                //Navigation                addnav("Aktionen");                //addnav("Höhle erkunden","wasserfall.php?op=explore");                if($u['marriedto']>0 && $u['charisma']>0 && $u['marriedto']!=4294967295) addnav("Höhle der Liebe","wasserfall.php?op=partner");                addnav("geheime Nebenhöhle","wasserfall.php?op=privat");                addnav("Umkehren");                addnav("Nach draussen","wasserfall.php");                //Textfeld                viewcommentary("wasserfall2","Hinzufügen",15);                output("`n`n`7Eine vorbei huschende Ratte ruft dir zu, dass dies ein Ort für Rollenspiel ist. Bitte halte die Rpg-Regeln ein.");        break;        case 'partner':     //Partnerraum               output("`b`7H`èö`àh`ul`òe der L`ui`àe`èb`7e`b`n`n`7Du denkst an d`èas W`àese`un, da`òs du liebst und das deine Sin`une v`àern`èebel`7t, während du deine`è E`èrkun`àdung`ustou`òr durch die Höhle fort setzt. A`uuf ein`àmal s`èiehst d`7u eine kleine Nische, d`èurch d`àie du oh`une zu `òzögern hindurch schlüpfst. Wa`us du d`àort s`èiehs`7t, raubt dir im ersten Mome`ènt d`àen Ate`um.`ò Durch kleine Rit`uzen d`àrin`ègt Lic`7ht von außen herein un`èd ver`àleih`ut dem O`òrt einen blauen Schimme`ur. Fun`àkeln`ède Tau`7tropfen glitzern an den M`èoosp`àolst`uern un`òd unter den Schw`uarm vo`àn Glü`èhwürm`7chen haben sich noch etliche Schm`èett`àerli`unge ge`òmischt. Wie gerne würdest du hier m`uit d`àeine`èm Schat`7z verweilen. Es würden sicherli`èch ein`àige der`u schö`ònsten Stunden in deinem `uLe`àben `èwerd`uen. `n`n");                //Daten aus der Datenbank holen                $loved = $u['acctid'];                $lovedid = $u['marriedto'];                $sql = "SELECT acctid,name,marriedto FROM accounts WHERE marriedto='$loved' AND acctid='$lovedid'";                $result = db_query($sql);                $row = db_fetch_assoc($result);                //Textfelder (nur für Partner)                if($u['acctid'] > $row['acctid']) viewcommentary("wasserfall - ".$row['acctid']."_".$u['acctid'],"Hinzufügen",15);        elseif($u['acctid'] < $row['acctid']) viewcommentary("wasserfall - ".$u['acctid']."_".$row['acctid'],"Hinzufügen",15);                //Navigation                addnav("Umkehren");                addnav("Zurück zur Höhle","wasserfall.php?op=hoehle");                addnav("Nach draussen","wasserfall.php");        break;        case 'privat':      //Einen Partner auswählen und einladen               output("`b`jD`Si`Fe`Y g`De`,heime Nebe`,n`Dh`Yö`Fh`Sl`je`b`n`n`jGerade, als d`Su dic`Fh hie`Yr in di`Desem `,Höhlenabschnitt ein k`Dlein w`Yenig e`Frhole`Sn möch`jtest, musst du a`Suf ei`Fnmal a`Yn ein`D ganz b`,estimmtes und zu dir lieb`Des Wes`,en denken. Wie es wohl w`Däre, w`Yenn i`Fhr zwe`Si euc`jh hier ungestört t`Sreffe`Fn kön`Yntet?`n`DAuf e`,inmal reißt dich ei`Dn ver`Ysch`Freck`Stes G`jurren aus deine`Sn Ged`Fanke`Yn und`D du sc`,haust dich hastig um. Ta`Dtsä`Ychli`Fch, d`Su hat`jtest dir das nicht n`Sur ein`Fgebi`Yldet.`D Auf e`,inem Stein saß eine w`Deiß`Ye Taub`Fe, die s`Sich wo`jhl ein klein wenig v`Serflo`Fgen h`Yatte`D. Sof`,ort nutzt du die Cha`Dnce u`Ynd sc`Fhrei`Sbst `jeine kleine Notiz auf ei`Snen Z`Fette`Yl, welc`Dhen d`,u der erstaunlich zahmen T`Daub`Ye an de`Fn Fuß b`Sinde`jst. Anschließend nimm`Sst du`F sie v`Yorsi`Dchti`,g in die Hand und tr`Dägs`Yt sie`F zu ei`Snem S`jpalt in der Höhle`Snwa`Fnd, du`Yrch de`Dn Tag`,eslicht nach i`Dnne`Yn dr`Finge`Sn kon`jnte und lässt s`Sie f`Flieg`Yen.`nJ`Detzt`, musst du ja nur no`Dch wa`Yrte`Fn und`S hof`jfen, dass die Pers`Son, an`F die d`Yu ged`Dacht`, hast, die Ein`Dladu`Yng bek`Fommt un`Sd auc`jh annimmt. `n`n");                //Partner für Privatbereich aus der DB holen                $partner = $u['acctid'];                $partner2 = $u['privatID'];                $sql = "SELECT acctid,name,privatID FROM accounts WHERE privatID='$partner' AND acctid='$partner2'";                $result = db_query($sql);                $row = db_fetch_assoc($result);                //für Tests                /*output($row['name']." ist mit dir im Partnerchat!");                output($row['acctid']." ist die ID deines Partners!");                output($row['privatID']." ist die privatID deines Partners!");'*/                //Textfeld                if($u['privatID']!=0 && $row['privatID']==$u['acctid']){                        if($u['acctid'] > $row['acctid']) viewcommentary("privat - ".$row['acctid']."~".$u['acctid'],"Hinzufügen",15);                        elseif($u['acctid'] < $row['acctid']) viewcommentary("privat - ".$u['acctid']."~".$row['acctid'],"Hinzufügen",15);                        output("`n`n`n`b`7Du bist im Moment im Partnerchat mit:`b ".$row['name']);                }                output("`n`n`n`7Folgende Person/en haben dich für den Privatchat eingetragen:`n");                $sql2 = "SELECT name,acctid,privatID FROM accounts WHERE privatID='$partner'";                $result2 = db_query($sql2);                output("<table border=0 cellpadding=2 cellspacing=1 bgcolor='#999999'>",true);                output("<tr class='trhead'><td><b>ID</b></td><td><b>Name</b></td></tr>",true);                for($i=0;$i<db_num_rows($result2);$i++){                        $row2 = db_fetch_assoc($result2);                        output("<tr class='".($i%2?"trdark":"trlight")."'>",true);                        output("<td align='center'>",true);                        output("`&{$row2['acctid']}`0");                        output("</td><td align='center'>",true);                        output("{$row2['name']}");                        output("</td></tr>",true);                }                output("</table>",true);                //Navigation                addnav("Aktionen");                if($u['privatID']==0) addnav("Partner suchen","wasserfall.php?op=search");                else addnav("Partner ändern","wasserfall.php?op=change");                addnav("Aktualisieren","wasserfall.php?op=privat");                addnav("Umkehren");                addnav("Zurück zur Höhle","wasserfall.php?op=hoehle");                addnav("Nach draussen","wasserfall.php");        break;        case 'search':      //gewünschten Spieler suchen                output("`c<form action='wasserfall.php?op=search&who=search2' method='POST'>Nach Name suchen:                          <input name='name'>                          <input type='submit' class='button' value='Suchen'>                          </form>`c",true);                addnav("","wasserfall.php?op=search&who=search2");                addnav("Umkehren");                addnav("Zurück zur Kristallhöhle","wasserfall.php?op=privat");                switch($_GET['who']){                        case 'search2':                                $_POST['name'] = stripslashes($_POST['name']);                                $StrLen = StrLen($_POST['name']);                                $who = '';                                for($i = 0; $i < $StrLen; $i++) {                                        $who .= '%'.$_POST['name']{$i};                                }                                $who .= '%';                                $who = mysqli_real_escape_string($mysqli, $who);                                //output('`$Debug: `0'.$who);                                $sql = " SELECT acctid,name,privatID FROM accounts WHERE locked=0 AND name LIKE '%$who%' ORDER by acctid ASC";                                $result = db_query($sql) or die(sql_error($sql));                                if(db_num_rows($result)<1){                                        output("Keine Spieler vorhanden");                                }                                elseif(db_num_rows($result)>25){                                        output("Mehr als 25 Spieler gefunden! Suche bitte eingrenzen!");                                }else{                                        output("`c<table border=0 cellpadding=2 cellspacing=1 bgcolor='#999999'>",true);                                        output("<tr class='trhead'><td><b>ID</b></td><td><b>Name</b></td><td><b>Einladen</b></td></tr>",true);                                        for($i=0;$i<db_num_rows($result);$i++){                                                $row = db_fetch_assoc($result);                                                output("<tr class='".($i%2?"trdark":"trlight")."'>",true);                                                output("<td align='center'>",true);                                                output("`&{$row['acctid']}`0");                                                output("</td><td align='center'>",true);                                                output("{$row['name']}");                                                output("</td><td align='center'>",true);                                                output("<a href='wasserfall.php?op=add&ID={$row['acctid']}'>X</a>",true);                                                addnav("","wasserfall.php?op=add&ID={$row['acctid']}");                                                output("</td></tr>",true);                                        }                                        output("</table>`c",true);                                }                        break;                }        break;        case 'add':         //gewünschten Spieler eintragen in das Datenbankfeld                $partner = $_GET['ID'];                $sql = "SELECT acctid,name,sex FROM accounts WHERE acctid='$partner'";                $result = db_query($sql);                $row = db_fetch_assoc($result);                addnav("Zurück zur Höhle","wasserfall.php?op=privat");                if($u['privatID']==0 && $partner!=$u['acctid']){                        $u['privatID'] = $partner;                        if($row['sex']==0) $sex = "dein Partner";                        elseif($row['sex']==1) $sex = "deine Partnerin";                        output("`7Du hast dich entschieden, dass {$row['name']} `7$sex werden soll. ".($row[sex]?"Sie":"Er")." wurde per YOM benachrichtigt!");                        systemmail($row['acctid'],"`@Einladung zum Partnerchat!`0","".$session[user][name]." `7hat dich zum Partnerchat (Wasserfall - geheime Nebenhöhle) eingeladen! Du kannst ".($session[user][sex]?"ihr":"ihm")." dort entweder entgegenkommen oder ".($session[user][sex]?"sie":"ihn")." ignorieren.");                }                elseif($partner==$u['acctid']){                        output("`7Führst du gerne Selbstgespräche? Wähle jemand anderen als dich selbst!");                }                elseif($u['privatID']==$partner){                        output($row['name']." `7ist bereits dein Partner. Es besteht keine Notwendigkeit ihn ein zweites Mal auszuwählen ;)");                }else{                        output("`7Du bist bereits mit {$u['privatID']} im Privatchat! Wechsle zuerst den Partner, bevor du einen Neuen auswählst!");                }        break;        case 'change':      //Partner zurücksetzen auf 0                $u['privatID'] = 0;                output("`7Dein Partner wurde zurückgesetzt. Nun kannst du einen Neuen suchen!`n");                output("`c<form action='wasserfall.php?op=search&who=search2' method='POST'>Nach Name suchen:                          <input name='name'>                          <input type='submit' class='button' value='Suchen'>                          </form>`c",true);                addnav("","wasserfall.php?op=search&who=search2");                addnav("Zurück zur Kristallhöhle","wasserfall.php?op=privat");        break;}page_footer();

